<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRT ìë§‰ ë‹¤êµ­ì–´ ë²ˆì—­ê¸°</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9375549032833516"
     crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        /* ì „ì—­ ìŠ¤íƒ€ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-navigation {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            background: #f8f9fa;
        }

        .tab-button {
            flex: 1;
            padding: 20px 30px;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .tab-button.active {
            color: #667eea;
            background: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #667eea;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            padding: 40px 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ë‹¨ì–´ ìˆ˜ì • ìŠ¤íƒ€ì¼ */
        .word-replacement-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .word-replacement-item {
            display: flex;
            gap: 10px;
            align-items: center;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .word-input-group {
            flex: 1;
            display: flex;
            gap: 10px;
        }

        .word-input-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .word-input-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #666;
        }

        .word-input {
            padding: 10px 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .word-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-remove {
            padding: 10px 16px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: flex-end;
        }

        .btn-remove:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        .btn-add {
            padding: 12px 24px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-add:hover {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        /* í™”ì ë§¤í•‘ ìŠ¤íƒ€ì¼ */
        .speaker-mapping-item {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            animation: slideIn 0.3s ease;
        }

        .speaker-mapping-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .speaker-kr-input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #667eea;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
        }

        .speaker-lang-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .speaker-lang-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .speaker-lang-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #888;
        }

        .speaker-lang-input {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .speaker-lang-input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* í¼ ì„¹ì…˜ */
        .form-section {
            margin-bottom: 30px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 1rem;
        }

        .label-text {
            font-size: 1.1rem;
        }

        .required {
            color: #e74c3c;
            margin-left: 4px;
        }

        /* API í‚¤ ì…ë ¥ ê·¸ë£¹ */
        .api-key-group {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .api-key-input-wrapper {
            flex: 1;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .btn-secondary {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-secondary:hover {
            background: #5568d3;
        }

        .btn-secondary.edit {
            background: #28a745;
        }

        .btn-secondary.edit:hover {
            background: #218838;
        }

        .form-help {
            display: block;
            margin-top: 8px;
            color: #666;
            font-size: 0.9rem;
        }

        .form-help a {
            color: #667eea;
            text-decoration: none;
        }

        .form-help a:hover {
            text-decoration: underline;
        }

        .saved-badge {
            display: inline-block;
            padding: 4px 12px;
            background: #28a745;
            color: white;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-top: 8px;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ */
        .file-upload-wrapper {
            position: relative;
        }

        .file-input {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            overflow: hidden;
        }

        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 30px;
            border: 3px dashed #d0d0d0;
            border-radius: 10px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .file-upload-label:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .file-upload-wrapper.drag-over .file-upload-label {
            border-color: #667eea;
            background: #e8eeff;
            transform: scale(1.02);
        }

        .file-icon {
            font-size: 2rem;
        }

        #file-name {
            font-weight: 500;
            color: #555;
        }

        /* ì–¸ì–´ ì„ íƒ ê·¸ë¦¬ë“œ */
        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .language-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .language-checkbox:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .language-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .language-name {
            font-weight: 500;
            color: #333;
        }

        .language-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .btn-link {
            background: none;
            border: none;
            color: #667eea;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 5px 10px;
            text-decoration: underline;
        }

        .btn-link:hover {
            color: #5568d3;
        }

        /* ì œì¶œ ë²„íŠ¼ */
        .btn-primary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ì¬ì‹œë„ ë²„íŠ¼ */
        .btn-retry {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
            margin-top: 15px;
        }

        .btn-retry:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.6);
        }

        .btn-retry:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ì œì–´ ë²„íŠ¼ ê·¸ë£¹ */
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-control {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-pause {
            background: #ffc107;
            color: #333;
        }

        .btn-pause:hover {
            background: #ffb300;
        }

        .btn-resume {
            background: #28a745;
            color: white;
        }

        .btn-resume:hover {
            background: #218838;
        }

        .btn-cancel {
            background: #dc3545;
            color: white;
        }

        .btn-cancel:hover {
            background: #c82333;
        }

        /* ì§„í–‰ ìƒíƒœ */
        .progress-section {
            margin-top: 30px;
            padding: 25px;
            background: #f0f4ff;
            border-radius: 10px;
            border: 2px solid #667eea;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid #e0e0e0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .spinner.paused {
            animation-play-state: paused;
            border-top-color: #ffc107;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .timer-container {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .timer-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            align-items: flex-end;
        }

        .timer-label {
            font-size: 0.7rem;
            color: #999;
            font-weight: 600;
            text-align: center;
            margin-bottom: 2px;
        }

        .timer {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .timer-remaining {
            background: #f39c12;
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .timer-total {
            background: #27ae60;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .timer-total-remaining {
            background: #e67e22;
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        #progressText {
            font-weight: 600;
            color: #667eea;
            font-size: 1.1rem;
        }

        .progress-details {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .error-warning {
            margin-top: 10px;
            padding: 15px;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #856404;
        }

        .retry-info {
            margin-top: 10px;
            padding: 15px;
            background: #e8f5e9;
            border: 1px solid #4caf50;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #2e7d32;
        }

        .pause-notice {
            margin-top: 10px;
            padding: 15px;
            background: #fff8e1;
            border: 1px solid #ffc107;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #f57c00;
            text-align: center;
            font-weight: 600;
        }

        /* ì—ëŸ¬ ë©”ì‹œì§€ */
        .error-section {
            margin-top: 30px;
            padding: 20px;
            background: #fff5f5;
            border: 2px solid #e74c3c;
            border-radius: 10px;
        }

        .error-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .error-icon {
            font-size: 1.5rem;
        }

        #errorText {
            color: #c0392b;
            font-weight: 600;
        }

        /* API í‚¤ ì„¹ì…˜ (í‘¸í„° ìœ„) */
        .api-key-section {
            padding: 15px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }

        .api-key-section .form-section {
            margin-bottom: 0;
        }

        .api-key-section .form-label {
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .api-key-section .form-input {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .api-key-section .btn-secondary {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .api-key-section .form-help {
            font-size: 0.8rem;
        }

        .api-key-section .saved-badge {
            font-size: 0.75rem;
            padding: 3px 10px;
        }

        /* í‘¸í„° */
        .footer {
            padding: 15px;
            text-align: center;
            background: #e8e8e8;
            color: #666;
            font-size: 0.85rem;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 30px 20px;
            }
            
            .language-grid {
                grid-template-columns: 1fr;
            }

            .api-key-group {
                flex-direction: column;
            }

            .btn-group {
                flex-direction: row;
            }

            .progress-header {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <header class="header">
            <h1>ğŸŒ SRT ìë§‰ ë³€í™˜ ë„êµ¬</h1>
            <p class="subtitle">GPT API ë²ˆì—­ & í”„ë¦¬ë¯¸ì–´ ìë§‰ ë³€í™˜</p>
        </header>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="tab-navigation">
            <button class="tab-button active" data-tab="file-generate">
                1. íŒŒì¼ ìƒì„±
            </button>
            <button class="tab-button" data-tab="replace">
                2. ë‹¨ì–´/í™”ìëª… ìˆ˜ì •
            </button>
            <button class="tab-button" data-tab="translation">
                3. ê° ë‚˜ë¼ë³„ ë²ˆì—­
            </button>
            <button class="tab-button" data-tab="premiere">
                4. í”„ë¦¬ë¯¸ì–´ ìë§‰ ë³€í™˜
            </button>
        </nav>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- íƒ­ 1: íŒŒì¼ ìƒì„± -->
            <div id="tab-file-generate" class="tab-content active">
                <!-- SRT ë³µì œ -->
                <div class="form-section">
                    <label class="form-label">
                        <span class="label-text">ğŸ“‹ 1-1. SRT íŒŒì¼ ë³µì œ (ë‹¤êµ­ì–´ íŒŒì¼ ìƒì„±)</span>
                    </label>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="clone_srt_file" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 0.95rem;">
                            ğŸ“„ í•œêµ­ì–´ SRT íŒŒì¼ ì—…ë¡œë“œ <span class="required">*</span>
                        </label>
                        <div class="file-upload-wrapper" id="cloneSrtWrapper">
                            <input 
                                type="file" 
                                id="clone_srt_file" 
                                accept=".srt" 
                                class="file-input"
                            >
                            <label for="clone_srt_file" class="file-upload-label">
                                <span class="file-icon">ğŸ“</span>
                                <span id="clone-srt-file-name">í•œêµ­ì–´.srt íŒŒì¼ ì„ íƒ</span>
                            </label>
                        </div>
                        <small style="display: block; margin-top: 8px; color: #666; font-size: 0.9rem;">
                            ğŸ’¡ ì˜ì–´, ì¼ë³¸ì–´, ì¤‘êµ­ì–´, ì¸ë„ë„¤ì‹œì•„ì–´, ìŠ¤í˜ì¸ì–´, íƒœêµ­ì–´ ì´ 6ê°œ íŒŒì¼ë¡œ ë³µì œë©ë‹ˆë‹¤
                        </small>
                    </div>

                    <button type="button" id="cloneSrtBtn" class="btn-primary">
                        ğŸ“‹ SRT ë³µì œí•˜ê¸°
                    </button>
                </div>

                <!-- ì§„í–‰ ìƒíƒœ -->
                <div id="fileGenerateProgressSection" class="progress-section" style="display: none;">
                    <div class="progress-header">
                        <div class="progress-info">
                            <div class="spinner" id="fileGenerateSpinner"></div>
                            <div style="flex: 1;">
                                <p id="fileGenerateProgressText">ì²˜ë¦¬ ì¤€ë¹„ ì¤‘...</p>
                                <p class="progress-details" id="fileGenerateProgressDetails"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
                <div id="fileGenerateErrorSection" class="error-section" style="display: none;">
                    <div class="error-content">
                        <span class="error-icon">âš ï¸</span>
                        <p id="fileGenerateErrorText"></p>
                    </div>
                </div>

                <!-- êµ¬ë¶„ì„  -->
                <hr style="margin: 40px 0; border: none; border-top: 2px solid #e0e0e0;">

                <!-- API í‚¤ ì„¤ì • -->
                <div class="form-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <label class="form-label" style="margin-bottom: 0;">
                            <span class="label-text">ğŸ”‘ OpenAI API í‚¤ ì„¤ì •</span>
                        </label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span id="savedBadge" class="saved-badge" style="display: none;">âœ“ ì €ì¥ë¨</span>
                            <button type="button" id="editKeyBtn" class="btn-secondary edit" style="display: none;">ìˆ˜ì •</button>
                        </div>
                    </div>
                    
                    <div id="apiKeyInputSection" style="display: none;">
                        <div class="api-key-group">
                            <div class="api-key-input-wrapper">
                                <input 
                                    type="password" 
                                    id="api_key" 
                                    name="api_key" 
                                    class="form-input" 
                                    placeholder="sk-..." 
                                    required
                                >
                                <small class="form-help">
                                    API í‚¤ëŠ” <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI í”Œë«í¼</a>ì—ì„œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                </small>
                            </div>
                            <div class="btn-group">
                                <button type="button" id="saveKeyBtn" class="btn-secondary">ì €ì¥</button>
                                <button type="button" id="cancelKeyBtn" class="btn-secondary" style="display: none;">ì·¨ì†Œ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- íƒ­ 3: ê° ë‚˜ë¼ë³„ ë²ˆì—­ -->
            <div id="tab-translation" class="tab-content">
                <!-- 3-1. í™”ìëª… ë³€ê²½ëœ ë²ˆì—­ -->
                <div class="form-section">
                    <label class="form-label">
                        <span class="label-text">ğŸ‘¥ 3-1. í™”ìëª… ë³€ê²½ëœ ë²ˆì—­</span>
                    </label>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="speaker_srt_files" style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 0.95rem;">
                            ğŸ“„ SRT íŒŒì¼ ì—…ë¡œë“œ (ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥) <span class="required">*</span>
                        </label>
                        <div class="file-upload-wrapper" id="speakerSrtFilesWrapper">
                            <input 
                                type="file" 
                                id="speaker_srt_files" 
                                accept=".srt" 
                                multiple
                                class="file-input"
                            >
                            <label for="speaker_srt_files" class="file-upload-label">
                                <span class="file-icon">ğŸ“</span>
                                <span id="speaker-srt-file-names">SRT íŒŒì¼ ì„ íƒ (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)</span>
                            </label>
                        </div>
                        <small style="display: block; margin-top: 8px; color: #666; font-size: 0.9rem;">
                            ğŸ’¡ ì—…ë¡œë“œí•œ ê° íŒŒì¼ì˜ í•œêµ­ì–´ë§Œ ë²ˆì—­ë˜ë©°, ì˜ì–´ ë“± ë‹¤ë¥¸ ì–¸ì–´ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤
                        </small>
                    </div>

                    <button type="button" id="speakerTranslateBtn" class="btn-primary">
                        ğŸš€ ë²ˆì—­ ì‹œì‘
                    </button>
                </div>

                <!-- í™”ìëª… ë²ˆì—­ ì§„í–‰ ìƒíƒœ -->
                <div id="speakerProgressSection" class="progress-section" style="display: none;">
                    <div class="progress-header">
                        <div class="progress-info">
                            <div class="spinner" id="speakerSpinner"></div>
                            <div style="flex: 1;">
                                <p id="speakerProgressText">ë²ˆì—­ ì¤€ë¹„ ì¤‘...</p>
                                <p class="progress-details" id="speakerProgressDetails"></p>
                            </div>
                        </div>
                        <div class="timer-container">
                            <div class="timer-group">
                                <div class="timer-label">í˜„ì¬ íŒŒì¼</div>
                                <div class="timer" id="speakerTimer">â±ï¸ 00:00:00</div>
                                <div class="timer-remaining" id="speakerTimerRemaining" style="display: none;">â³ 00:00:00</div>
                            </div>
                            <div class="timer-group">
                                <div class="timer-label">ì „ì²´</div>
                                <div class="timer-total" id="speakerTimerTotal">ğŸ• 00:00:00</div>
                                <div class="timer-total-remaining" id="speakerTimerTotalRemaining" style="display: none;">â³ 00:00:00</div>
                            </div>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="speakerProgressBar" style="width: 0%">0%</div>
                    </div>
                    <div id="speakerPauseNotice" class="pause-notice" style="display: none;">
                        â¸ï¸ ë²ˆì—­ì´ ì¼ì‹œì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. "ì¬ê°œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê³„ì†í•˜ì„¸ìš”.
                    </div>
                </div>

                <!-- í™”ìëª… ë²ˆì—­ ì œì–´ ë²„íŠ¼ -->
                <div id="speakerControlButtons" class="form-section" style="display: none;">
                    <div class="btn-group">
                        <button type="button" id="speakerPauseBtn" class="btn-secondary">â¸ï¸ ì¼ì‹œì •ì§€</button>
                        <button type="button" id="speakerResumeBtn" class="btn-secondary" style="display: none;">â–¶ï¸ ì¬ê°œ</button>
                        <button type="button" id="speakerCancelBtn" class="btn-secondary">âŒ ì·¨ì†Œ</button>
                    </div>
                </div>

                <!-- í™”ìëª… ë²ˆì—­ ì—ëŸ¬ -->
                <div id="speakerErrorSection" class="error-section" style="display: none;">
                    <div class="error-content">
                        <span class="error-icon">âš ï¸</span>
                        <p id="speakerErrorText"></p>
                    </div>
                </div>

                <!-- êµ¬ë¶„ì„  -->
                <hr style="margin: 40px 0; border: none; border-top: 2px solid #e0e0e0;">

                <!-- 3-2. ì „ì²´ ë²ˆì—­ -->
                <form id="translationForm">
                <div class="form-section">
                    <label class="form-label">
                        <span class="label-text">ğŸŒ 3-2. ì „ì²´ ë²ˆì—­</span>
                    </label>
                </div>

                <!-- íŒŒì¼ ì—…ë¡œë“œ -->
                <div class="form-section">
                    <label for="srt_file" class="form-label">
                        <span class="label-text">ğŸ“„ SRT íŒŒì¼ ì—…ë¡œë“œ (ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥)</span>
                        <span class="required">*</span>
                    </label>
                    <div class="file-upload-wrapper" id="fullTranslateWrapper">
                        <input 
                            type="file" 
                            id="srt_file" 
                            name="srt_file" 
                            accept=".srt" 
                            class="file-input" 
                            multiple
                            required
                        >
                        <label for="srt_file" class="file-upload-label">
                            <span class="file-icon">ğŸ“</span>
                            <span id="file-name">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš” (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)</span>
                        </label>
                    </div>
                    <small style="display: block; margin-top: 8px; color: #666; font-size: 0.9rem;">
                        ğŸ’¡ ê° íŒŒì¼ì˜ í•œêµ­ì–´ë§Œ ë²ˆì—­ë˜ë©°, ì˜ì–´ ë“± ë‹¤ë¥¸ ì–¸ì–´ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤
                    </small>
                </div>

                <!-- ì–¸ì–´ ì„ íƒ -->
                <div class="form-section">
                    <label class="form-label">
                        <span class="label-text">ğŸŒ ë²ˆì—­í•  ì–¸ì–´ ì„ íƒ</span>
                        <span class="required">*</span>
                    </label>
                    <div class="language-grid">
                        <label class="language-checkbox">
                            <input type="checkbox" name="languages" value="en" id="lang_en">
                            <span class="language-name">English (ì˜ì–´)</span>
                        </label>
                        <label class="language-checkbox">
                            <input type="checkbox" name="languages" value="ja" id="lang_ja">
                            <span class="language-name">Japanese (ì¼ë³¸ì–´)</span>
                        </label>
                        <label class="language-checkbox">
                            <input type="checkbox" name="languages" value="th" id="lang_th">
                            <span class="language-name">Thai (íƒœêµ­ì–´)</span>
                        </label>
                        <label class="language-checkbox">
                            <input type="checkbox" name="languages" value="zh" id="lang_zh">
                            <span class="language-name">Chinese (ì¤‘êµ­ì–´)</span>
                        </label>
                        <label class="language-checkbox">
                            <input type="checkbox" name="languages" value="id" id="lang_id">
                            <span class="language-name">Indonesian (ì¸ë„ë„¤ì‹œì•„ì–´)</span>
                        </label>
                        <label class="language-checkbox">
                            <input type="checkbox" name="languages" value="es" id="lang_es">
                            <span class="language-name">Spanish (ìŠ¤í˜ì¸ì–´)</span>
                        </label>
                    </div>
                    <div class="language-actions">
                        <button type="button" id="selectAll" class="btn-link">ì „ì²´ ì„ íƒ</button>
                        <button type="button" id="deselectAll" class="btn-link">ì „ì²´ í•´ì œ</button>
                    </div>
                </div>

                <!-- ì œì¶œ ë²„íŠ¼ -->
                <div class="form-section">
                    <button type="submit" id="submitBtn" class="btn-primary">
                        ğŸš€ ë²ˆì—­ ì‹œì‘
                    </button>
                    <!-- ì¬ì‹œë„ ë²„íŠ¼ -->
                    <button type="button" id="retryBtn" class="btn-retry" style="display: none;">
                        ğŸ”„ ì‹¤íŒ¨í•œ ë¸”ë¡ ì¬ì‹œë„
                    </button>
                    <!-- ì œì–´ ë²„íŠ¼ -->
                    <div id="controlButtons" class="control-buttons" style="display: none;">
                        <button type="button" id="pauseBtn" class="btn-control btn-pause">
                            â¸ï¸ ì¼ì‹œì •ì§€
                        </button>
                        <button type="button" id="resumeBtn" class="btn-control btn-resume" style="display: none;">
                            â–¶ï¸ ì¬ê°œ
                        </button>
                        <button type="button" id="cancelBtn" class="btn-control btn-cancel">
                            âŒ ì·¨ì†Œ
                        </button>
                    </div>
                </div>

                <!-- ì§„í–‰ ìƒíƒœ -->
                <div id="progressSection" class="progress-section" style="display: none;">
                    <div class="progress-header">
                        <div class="progress-info">
                            <div class="spinner" id="spinner"></div>
                            <div style="flex: 1;">
                                <p id="progressText">ë²ˆì—­ ì¤€ë¹„ ì¤‘...</p>
                                <p class="progress-details" id="progressDetails"></p>
                                <p class="progress-details" id="overallProgress" style="margin-top: 5px; color: #999;"></p>
                            </div>
                        </div>
                        <div class="timer-container">
                            <!-- í˜„ì¬ ì–¸ì–´ íƒ€ì´ë¨¸ -->
                            <div class="timer-group">
                                <div class="timer-label">í˜„ì¬ ì–¸ì–´</div>
                                <div class="timer" id="timer">â±ï¸ 00:00:00</div>
                                <div class="timer-remaining" id="timerRemaining" style="display: none;">â³ ê³„ì‚° ì¤‘...</div>
                            </div>
                            <!-- ì „ì²´ íƒ€ì´ë¨¸ -->
                            <div class="timer-group">
                                <div class="timer-label">ì „ì²´</div>
                                <div class="timer-total" id="timerTotal">ğŸ• 00:00:00</div>
                                <div class="timer-total-remaining" id="timerTotalRemaining" style="display: none;">âŒ› ê³„ì‚° ì¤‘...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì§„í–‰ë¥  ë°” -->
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="progressBar" style="width: 0%;">
                            <span id="progressPercent">0%</span>
                        </div>
                    </div>

                    <div id="pauseNotice" class="pause-notice" style="display: none;">
                        â¸ï¸ ì¼ì‹œì •ì§€ ì¤‘... ì¬ê°œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”
                    </div>
                    <div id="errorWarning" class="error-warning" style="display: none;"></div>
                    <div id="retryInfo" class="retry-info" style="display: none;"></div>
                </div>

                <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
                <div id="errorSection" class="error-section" style="display: none;">
                    <div class="error-content">
                        <span class="error-icon">âš ï¸</span>
                        <p id="errorText"></p>
                    </div>
                </div>

                <!-- êµ¬ë¶„ì„  -->
                <hr style="margin: 40px 0; border: none; border-top: 2px solid #e0e0e0;">

                <!-- 3-3. ê²€í† (ë¸”ë¡ë²ˆí˜¸, í•œê¸€) -->
                <div class="form-section">
                    <label class="form-label">
                        <span class="label-text">ğŸ” 3-3. ê²€í†  (ë¸”ë¡ë²ˆí˜¸, í•œê¸€)</span>
                    </label>
                    <small style="display: block; margin-top: 8px; color: #666; font-size: 0.9rem;">
                        ğŸ’¡ SRT íŒŒì¼ì˜ ë§ˆì§€ë§‰ ë¸”ë¡ë²ˆí˜¸ì™€ í•œê¸€ì´ ë‚¨ì•„ìˆëŠ” ë¸”ë¡ì„ í™•ì¸í•©ë‹ˆë‹¤
                    </small>
                </div>

                <!-- íŒŒì¼ ì—…ë¡œë“œ -->
                <div class="form-section">
                    <label for="review_files" class="form-label">
                        <span class="label-text">ğŸ“„ SRT íŒŒì¼ ì—…ë¡œë“œ (ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥)</span>
                        <span class="required">*</span>
                    </label>
                    <div class="file-upload-wrapper" id="reviewFilesWrapper">
                        <input 
                            type="file" 
                            id="review_files" 
                            accept=".srt" 
                            multiple
                            class="file-input"
                        >
                        <label for="review_files" class="file-upload-label">
                            <span class="file-icon">ğŸ“</span>
                            <span id="review-file-names">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš” (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)</span>
                        </label>
                    </div>
                </div>

                <button type="button" id="reviewBtn" class="btn-primary">
                    ğŸ” ê²€í†  ì‹œì‘
                </button>

                <!-- ê²€í†  ê²°ê³¼ -->
                <div id="reviewResultSection" style="display: none; margin-top: 30px;">
                    <div class="form-section">
                        <label class="form-label">
                            <span class="label-text">ğŸ“‹ ê²€í†  ê²°ê³¼</span>
                        </label>
                        <div id="reviewResultContent" style="
                            background: #f8f9fa;
                            border: 1px solid #e0e0e0;
                            border-radius: 8px;
                            padding: 20px;
                            max-height: 500px;
                            overflow-y: auto;
                            font-family: 'Consolas', 'Monaco', monospace;
                            font-size: 0.9rem;
                            line-height: 1.6;
                            white-space: pre-wrap;
                        "></div>
                        <button type="button" id="downloadReviewLogBtn" class="btn-secondary" style="margin-top: 15px;">
                            ğŸ’¾ ë¡œê·¸ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                </div>

                <!-- ê²€í†  ì—ëŸ¬ -->
                <div id="reviewErrorSection" class="error-section" style="display: none;">
                    <div class="error-content">
                        <span class="error-icon">âš ï¸</span>
                        <p id="reviewErrorText"></p>
                    </div>
                </div>
            </form>
            </div>

            <!-- íƒ­ 2: ë‹¨ì–´/í™”ìëª… ìˆ˜ì • -->
            <div id="tab-replace" class="tab-content">
                <form id="replaceForm">
                    <!-- 2-1. ë‹¨ì–´/í™”ìëª… ìˆ˜ì • -->
                    <div class="form-section">
                        <label class="form-label">
                            <span class="label-text">âœï¸ 2-1. ë‹¨ì–´/í™”ìëª… ìˆ˜ì •</span>
                        </label>
                    </div>

                    <!-- íŒŒì¼ ì—…ë¡œë“œ (í†µí•©) -->
                    <div class="form-section">
                        <label for="combined_files" class="form-label">
                            <span class="label-text">ğŸŒ ìˆ˜ì •í•  ì–¸ì–´ë³„ SRT íŒŒì¼ (ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥)</span>
                            <span class="required">*</span>
                        </label>
                        <div class="file-upload-wrapper" id="combinedFilesWrapper">
                            <input 
                                type="file" 
                                id="combined_files" 
                                name="combined_files" 
                                accept=".srt" 
                                multiple
                                class="file-input" 
                                required
                            >
                            <label for="combined_files" class="file-upload-label">
                                <span class="file-icon">ğŸ“</span>
                                <span id="combined-file-names">ì–¸ì–´ë³„ SRT íŒŒì¼ ì„ íƒ (ì˜ì–´, íƒœêµ­ì–´, ì¤‘êµ­ì–´, ë²ˆì²´, ì¼ë³¸ì–´, ìŠ¤í˜ì¸ì–´, ì¸ë„ë„¤ì‹œì•„ì–´)</span>
                            </label>
                        </div>
                        <small style="display: block; margin-top: 8px; color: #666; font-size: 0.9rem;">
                            ğŸ’¡ ë‹¨ì–´ ì¹˜í™˜ê³¼ í™”ìëª… ì¹˜í™˜ì´ ë™ì‹œì— ì ìš©ë©ë‹ˆë‹¤
                        </small>
                    </div>

                    <!-- ===== ë‹¨ì–´ ì¶”ê°€ ì˜ì—­ ===== -->
                    <div class="form-section" style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <label class="form-label" style="margin-bottom: 15px;">
                            <span class="label-text">âœï¸ ë‹¨ì–´ ì¶”ê°€</span>
                        </label>
                        
                        <!-- ë‹¨ì–´ ìˆ˜ì • ê´€ë¦¬ ë²„íŠ¼ -->
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button type="button" class="btn-add" onclick="addWordPair()" style="flex: 1;">
                                â• ë‹¨ì–´ ì¶”ê°€
                            </button>
                            <button type="button" class="btn-secondary" onclick="clearAllWordPairs()" style="flex: 1;">
                                ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ
                            </button>
                            <button type="button" class="btn-secondary" onclick="downloadWordPairs()" style="flex: 1;">
                                ğŸ’¾ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <label for="word_pairs_upload_file" class="btn-secondary" style="flex: 1; margin: 0; cursor: pointer; text-align: center;">
                                ğŸ“‚ ì—…ë¡œë“œ
                                <input type="file" id="word_pairs_upload_file" accept=".json,.txt" style="display: none;" onchange="uploadWordPairs(this)">
                            </label>
                        </div>

                        <div id="wordReplacementList" class="word-replacement-list">
                            <!-- ì´ˆê¸° ë‹¨ì–´ ìˆ˜ì • í•­ëª©ì€ JavaScriptë¡œ ë¡œë“œë¨ -->
                        </div>
                    </div>

                    <!-- ===== í™”ì ì¶”ê°€ ì˜ì—­ (ì „ì²´ ì´ë¦„) ===== -->
                    <div class="form-section" style="background: #f0f7ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <label class="form-label" style="margin-bottom: 15px;">
                            <span class="label-text">ğŸ­ í™”ì ì¶”ê°€ - ì „ì²´ ì´ë¦„ (ì˜ˆ: ì´í˜•ì¤€ â†’ Hyeong-jun)</span>
                        </label>
                        
                        <!-- í™”ì ë§¤í•‘ ê´€ë¦¬ ë²„íŠ¼ -->
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button type="button" class="btn-add" onclick="addSpeakerMapping()" style="flex: 1;">
                                â• í™”ì ì¶”ê°€
                            </button>
                            <button type="button" class="btn-secondary" onclick="clearAllSpeakers()" style="flex: 1;">
                                ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ
                            </button>
                            <button type="button" class="btn-secondary" onclick="downloadSpeakerMapping()" style="flex: 1;">
                                ğŸ’¾ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <label for="speaker_upload_file" class="btn-secondary" style="flex: 1; margin: 0; cursor: pointer; text-align: center;">
                                ğŸ“‚ ì—…ë¡œë“œ
                                <input type="file" id="speaker_upload_file" accept=".json,.txt" style="display: none;" onchange="uploadSpeakerMapping(this)">
                            </label>
                        </div>

                        <!-- í™”ì ë§¤í•‘ ë¦¬ìŠ¤íŠ¸ -->
                        <div id="speakerMappingList" class="word-replacement-list" style="max-height: 400px; overflow-y: auto;">
                            <!-- ì´ˆê¸° í™”ì ë§¤í•‘ í•­ëª© -->
                        </div>
                    </div>

                    <!-- ===== í™”ì ë¶€ë¶„ ì¶”ê°€ ì˜ì—­ (ì„± ì œì™¸) ===== -->
                    <div class="form-section" style="background: #fff5f0; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <label class="form-label" style="margin-bottom: 15px;">
                            <span class="label-text">ğŸ­ í™”ì ë¶€ë¶„ ì¶”ê°€ - ì„± ì œì™¸ (ì˜ˆ: í˜•ì¤€ â†’ Hyeong-jun)</span>
                        </label>
                        <small style="display: block; margin-bottom: 15px; color: #666; font-size: 0.9rem;">
                            ğŸ’¡ ìœ„ì˜ ì „ì²´ ì´ë¦„ ì¹˜í™˜ í›„, ì„±ì´ ë¹ ì§„ ì´ë¦„ë„ ì¶”ê°€ë¡œ ì¹˜í™˜í•©ë‹ˆë‹¤
                        </small>
                        
                        <!-- í™”ì ë¶€ë¶„ ë§¤í•‘ ê´€ë¦¬ ë²„íŠ¼ -->
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button type="button" class="btn-add" onclick="addSpeakerPartialMapping()" style="flex: 1;">
                                â• í™”ì ì¶”ê°€
                            </button>
                            <button type="button" class="btn-secondary" onclick="clearAllSpeakersPartial()" style="flex: 1;">
                                ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ
                            </button>
                            <button type="button" class="btn-secondary" onclick="downloadSpeakerPartialMapping()" style="flex: 1;">
                                ğŸ’¾ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <label for="speaker_partial_upload_file" class="btn-secondary" style="flex: 1; margin: 0; cursor: pointer; text-align: center;">
                                ğŸ“‚ ì—…ë¡œë“œ
                                <input type="file" id="speaker_partial_upload_file" accept=".json,.txt" style="display: none;" onchange="uploadSpeakerPartialMapping(this)">
                            </label>
                        </div>

                        <!-- í™”ì ë¶€ë¶„ ë§¤í•‘ ë¦¬ìŠ¤íŠ¸ -->
                        <div id="speakerPartialMappingList" class="word-replacement-list" style="max-height: 400px; overflow-y: auto;">
                            <!-- ì´ˆê¸° í™”ì ë¶€ë¶„ ë§¤í•‘ í•­ëª© -->
                        </div>
                    </div>

                    <!-- í†µí•© ì‹¤í–‰ ë²„íŠ¼ -->
                    <div class="form-section">
                        <button type="button" id="combinedProcessBtn" class="btn-primary" onclick="processCombinedChange()" style="font-size: 1.1rem; padding: 15px 30px;">
                            ğŸ”„ ë‹¨ì–´/í™”ìëª… ìˆ˜ì • ì‹œì‘
                        </button>
                        <small style="display: block; margin-top: 10px; color: #666; font-size: 0.85rem;">
                            ì‹¤í–‰ ìˆœì„œ: â‘  ë‹¨ì–´ ì¹˜í™˜ â†’ â‘¡ í™”ì ì „ì²´ ì´ë¦„ ì¹˜í™˜ â†’ â‘¢ í™”ì ë¶€ë¶„ ì´ë¦„(ì„± ì œì™¸) ì¹˜í™˜
                        </small>
                    </div>

                    <!-- ì§„í–‰ ìƒíƒœ -->
                    <div id="combinedProgressSection" class="progress-section" style="display: none;">
                        <div class="progress-header">
                            <div class="progress-info">
                                <div class="spinner" id="combinedSpinner"></div>
                                <div style="flex: 1;">
                                    <p id="combinedProgressText">ì²˜ë¦¬ ì¤€ë¹„ ì¤‘...</p>
                                    <p class="progress-details" id="combinedProgressDetails"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
                    <div id="combinedErrorSection" class="error-section" style="display: none;">
                        <div class="error-content">
                            <span class="error-icon">âš ï¸</span>
                            <p id="combinedErrorText"></p>
                        </div>
                    </div>

                </form>
            </div>

            <!-- íƒ­ 4: í”„ë¦¬ë¯¸ì–´ ìë§‰ ë³€í™˜ -->
            <div id="tab-premiere" class="tab-content">
                <form id="premiereForm">
                    <!-- íŒŒì¼ ì—…ë¡œë“œ (ë‹¤ì¤‘) -->
                    <div class="form-section">
                        <label for="premiere_files" class="form-label">
                            <span class="label-text">ğŸ“„ SRT íŒŒì¼ ì—…ë¡œë“œ (ì—¬ëŸ¬ íŒŒì¼ ê°€ëŠ¥)</span>
                            <span class="required">*</span>
                        </label>
                        <div class="file-upload-wrapper" id="premiereFileUploadWrapper">
                            <input 
                                type="file" 
                                id="premiere_files" 
                                name="premiere_files" 
                                accept=".srt" 
                                multiple
                                class="file-input" 
                                required
                            >
                            <label for="premiere_files" class="file-upload-label">
                                <span class="file-icon">ğŸ“</span>
                                <span id="premiere-file-names">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš” (ì—¬ëŸ¬ íŒŒì¼ ì„ íƒ ê°€ëŠ¥)</span>
                            </label>
                        </div>
                    </div>

                    <!-- ë³€í™˜ ë²„íŠ¼ -->
                    <div class="form-section">
                        <button type="submit" id="convertBtn" class="btn-primary">
                            ğŸ”„ ë³€í™˜ ì‹œì‘
                        </button>
                    </div>

                    <!-- ì§„í–‰ ìƒíƒœ -->
                    <div id="premiereProgressSection" class="progress-section" style="display: none;">
                        <div class="progress-header">
                            <div class="progress-info">
                                <div class="spinner" id="premiereSpinner"></div>
                                <div style="flex: 1;">
                                    <p id="premiereProgressText">ë³€í™˜ ì¤€ë¹„ ì¤‘...</p>
                                    <p class="progress-details" id="premiereProgressDetails"></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì§„í–‰ë¥  ë°” -->
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="premiereProgressBar" style="width: 0%;">
                                <span id="premiereProgressPercent">0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
                    <div id="premiereErrorSection" class="error-section" style="display: none;">
                        <div class="error-content">
                            <span class="error-icon">âš ï¸</span>
                            <p id="premiereErrorText"></p>
                        </div>
                    </div>
                </form>
            </div>
        </main>

        <!-- í‘¸í„° -->
        <footer class="footer">
            <p>Made with â¤ï¸ by SRT Translator</p>
        </footer>
    </div>

    <script>
        // ========================================
        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        // ========================================
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.getAttribute('data-tab');
                
                // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì»¨í…ì¸  ë¹„í™œì„±í™”
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // ì„ íƒëœ íƒ­ í™œì„±í™”
                button.classList.add('active');
                document.getElementById(`tab-${tabName}`).classList.add('active');
            });
        });

        // ========================================
        // íŒŒì¼ ìƒì„± ê¸°ëŠ¥ (íƒ­ 1)
        // ========================================
        
        // SRT ë³µì œ íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
        const cloneSrtInput = document.getElementById('clone_srt_file');
        const cloneSrtFileName = document.getElementById('clone-srt-file-name');
        
        cloneSrtInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                cloneSrtFileName.textContent = this.files[0].name;
            } else {
                cloneSrtFileName.textContent = 'í•œêµ­ì–´.srt íŒŒì¼ ì„ íƒ';
            }
        });

        // SRT ë³µì œ íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const cloneSrtWrapper = document.getElementById('cloneSrtWrapper');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            cloneSrtWrapper.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
            });
        });
        
        ['dragenter', 'dragover'].forEach(eventName => {
            cloneSrtWrapper.addEventListener(eventName, () => {
                cloneSrtWrapper.classList.add('drag-over');
            });
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            cloneSrtWrapper.addEventListener(eventName, () => {
                cloneSrtWrapper.classList.remove('drag-over');
            });
        });
        
        cloneSrtWrapper.addEventListener('drop', function(e) {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                cloneSrtInput.files = files;
                cloneSrtFileName.textContent = files[0].name;
            }
        });

        // SRT ë³µì œ
        document.getElementById('cloneSrtBtn').addEventListener('click', async function() {
            const file = cloneSrtInput.files[0];
            
            if (!file) {
                alert('í•œêµ­ì–´ SRT íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const btn = this;
            const progressSection = document.getElementById('fileGenerateProgressSection');
            const errorSection = document.getElementById('fileGenerateErrorSection');
            const spinner = document.getElementById('fileGenerateSpinner');
            
            btn.disabled = true;
            progressSection.style.display = 'block';
            errorSection.style.display = 'none';
            spinner.classList.add('active');
            
            try {
                document.getElementById('fileGenerateProgressText').textContent = 'SRT íŒŒì¼ ì½ëŠ” ì¤‘...';
                const srtContent = await file.text();
                
                // ë³µì œí•  ì–¸ì–´ ëª©ë¡
                const languages = ['ì˜ì–´', 'ì¼ë³¸ì–´', 'ì¤‘êµ­ì–´', 'ì¸ë„ë„¤ì‹œì•„ì–´', 'ìŠ¤í˜ì¸ì–´', 'íƒœêµ­ì–´'];
                
                const zip = new JSZip();
                
                for (let i = 0; i < languages.length; i++) {
                    const lang = languages[i];
                    
                    document.getElementById('fileGenerateProgressText').textContent = 
                        `ë³µì œ ì¤‘: ${lang}.srt`;
                    document.getElementById('fileGenerateProgressDetails').textContent = 
                        `${i + 1} / ${languages.length} íŒŒì¼`;
                    
                    zip.file(`${lang}.srt`, srtContent);
                }
                
                // ZIP ë‹¤ìš´ë¡œë“œ
                document.getElementById('fileGenerateProgressText').textContent = 'ZIP íŒŒì¼ ìƒì„± ì¤‘...';
                const zipBlob = await zip.generateAsync({ 
                    type: 'blob',
                    compression: 'DEFLATE',
                    compressionOptions: { level: 9 }
                });
                
                const url = URL.createObjectURL(zipBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = '2-1. ë‹¨ì–´ ìˆ˜ì •.zip';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                progressSection.style.display = 'none';
                spinner.classList.remove('active');
                alert(`âœ… SRT ë³µì œ ì™„ë£Œ!\n\n${languages.length}ê°œ ì–¸ì–´ íŒŒì¼ì´ ìƒì„±ë˜ì–´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
            } catch (error) {
                console.error('Error:', error);
                progressSection.style.display = 'none';
                spinner.classList.remove('active');
                errorSection.style.display = 'block';
                document.getElementById('fileGenerateErrorText').textContent = error.message;
            } finally {
                btn.disabled = false;
            }
        });

        // ========================================
        // ê° ë‚˜ë¼ë³„ ë²ˆì—­ (ê¸°ì¡´ ê¸°ëŠ¥)
        // ========================================
        
        // ì–¸ì–´ ë§¤í•‘
        const LANGUAGES = {
            'en': 'English',
            'ja': 'Japanese',
            'th': 'Thai',
            'zh': 'Chinese (Simplified)',
            'id': 'Indonesian',
            'es': 'Spanish'
        };

        // API í‚¤ ê´€ë¦¬
        const API_KEY_STORAGE = 'srt_translator_api_key';

        // ì „ì—­ ë³€ìˆ˜ - ë²ˆì—­ ìƒíƒœ ì €ì¥
        let originalBlocks = [];
        let translationResults = {};
        let failedBlocks = {};
        let currentFilename = '';
        let selectedLanguages = [];
        
        // ì œì–´ ë³€ìˆ˜
        let isPaused = false;
        let isCancelled = false;
        let startTime = null;
        let pauseStartTime = null;
        let totalPausedTime = 0;
        let timerInterval = null;
        let totalBlocks = 0;
        let completedBlocks = 0;
        let currentLangTotalBlocks = 0;
        let currentLangCompletedBlocks = 0;
        
        // ì „ì²´ ì‹œê°„ ê´€ë ¨ ë³€ìˆ˜
        let totalStartTime = null;
        let totalPausedTime2 = 0;
        let totalPauseStartTime = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ API í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('DOMContentLoaded', () => {
            const savedKey = localStorage.getItem(API_KEY_STORAGE);
            const apiKeyInputSection = document.getElementById('apiKeyInputSection');
            const editKeyBtn = document.getElementById('editKeyBtn');
            const savedBadge = document.getElementById('savedBadge');
            
            if (savedKey) {
                // ì €ì¥ëœ í‚¤ê°€ ìˆìœ¼ë©´: ì…ë ¥ë€ ìˆ¨ê¸°ê³ , "ì €ì¥ë¨" ë±ƒì§€ì™€ "ìˆ˜ì •" ë²„íŠ¼ë§Œ í‘œì‹œ
                document.getElementById('api_key').value = savedKey;
                apiKeyInputSection.style.display = 'none';
                editKeyBtn.style.display = 'block';
                savedBadge.style.display = 'inline-block';
            } else {
                // ì €ì¥ëœ í‚¤ê°€ ì—†ìœ¼ë©´: ì…ë ¥ë€ í‘œì‹œ
                apiKeyInputSection.style.display = 'block';
                editKeyBtn.style.display = 'none';
                savedBadge.style.display = 'none';
            }
        });

        // ì‹œê°„ í¬ë§· í•¨ìˆ˜
        function formatTime(ms) {
            const hours = Math.floor(ms / 3600000);
            const minutes = Math.floor((ms % 3600000) / 60000);
            const seconds = Math.floor((ms % 60000) / 1000);
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // íƒ€ì´ë¨¸ ì‹œì‘ (ì „ì²´ ì‘ì—… ì‹œì‘ ì‹œ í•œ ë²ˆë§Œ í˜¸ì¶œ)
        function startTotalTimer() {
            totalStartTime = Date.now();
            totalPausedTime2 = 0;
        }

        // íƒ€ì´ë¨¸ ì‹œì‘ (ê° ì–¸ì–´ë³„ë¡œ í˜¸ì¶œ)
        function startTimer() {
            startTime = Date.now();
            totalPausedTime = 0;
            timerInterval = setInterval(() => {
                if (!isPaused) {
                    // í˜„ì¬ ì–¸ì–´ íƒ€ì´ë¨¸
                    const elapsed = Date.now() - startTime - totalPausedTime;
                    document.getElementById('timer').textContent = `â±ï¸ ${formatTime(elapsed)}`;
                    
                    // ì „ì²´ íƒ€ì´ë¨¸
                    const totalElapsed = Date.now() - totalStartTime - totalPausedTime2;
                    document.getElementById('timerTotal').textContent = `ğŸ• ${formatTime(totalElapsed)}`;
                    
                    // ë‚¨ì€ ì‹œê°„ ê³„ì‚°
                    updateRemainingTime(elapsed, totalElapsed);
                }
            }, 1000);
        }

        // ë‚¨ì€ ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateRemainingTime(elapsed, totalElapsed) {
            // í˜„ì¬ ì–¸ì–´ ë‚¨ì€ ì‹œê°„
            if (currentLangCompletedBlocks > 10 && currentLangTotalBlocks > 0) {
                const avgTimePerBlock = elapsed / currentLangCompletedBlocks;
                const remainingBlocks = currentLangTotalBlocks - currentLangCompletedBlocks;
                const estimatedRemaining = avgTimePerBlock * remainingBlocks;
                
                document.getElementById('timerRemaining').style.display = 'block';
                document.getElementById('timerRemaining').textContent = `â³ ${formatTime(estimatedRemaining)}`;
            }
            
            // ì „ì²´ ë‚¨ì€ ì‹œê°„ (ì „ì²´ ì§„í–‰ë¥  ê¸°ë°˜)
            const totalProgress = completedBlocks / totalBlocks;
            if (totalProgress > 0.05 && totalBlocks > 0) {
                const avgTimePerTotalBlock = totalElapsed / completedBlocks;
                const remainingTotalBlocks = totalBlocks - completedBlocks;
                const estimatedTotalRemaining = avgTimePerTotalBlock * remainingTotalBlocks;
                
                document.getElementById('timerTotalRemaining').style.display = 'block';
                document.getElementById('timerTotalRemaining').textContent = `âŒ› ${formatTime(estimatedTotalRemaining)}`;
            }
        }

        // íƒ€ì´ë¨¸ ì •ì§€
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress(currentLangBlock, totalLangBlocks, langName = '', langIndex = 0, totalLangs = 1) {
            const percent = Math.round((currentLangBlock / totalLangBlocks) * 100);
            
            // í˜„ì¬ ì–¸ì–´ ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
            currentLangTotalBlocks = totalLangBlocks;
            currentLangCompletedBlocks = currentLangBlock;
            
            // ì „ì²´ ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì´ì „ ì–¸ì–´ë“¤ì€ ì™„ë£Œ + í˜„ì¬ ì–¸ì–´ ì§„í–‰)
            completedBlocks = (langIndex * totalLangBlocks) + currentLangBlock;
            totalBlocks = totalLangs * totalLangBlocks;
            
            console.log(`ì§„í–‰ë¥  ì—…ë°ì´íŠ¸: ${langName} ${currentLangBlock}/${totalLangBlocks} (${percent}%) - ì–¸ì–´ ${langIndex + 1}/${totalLangs}`);
            
            document.getElementById('progressBar').style.width = `${percent}%`;
            document.getElementById('progressPercent').textContent = `${percent}%`;
            
            if (langName) {
                document.getElementById('progressText').textContent = 
                    `${langName}: ${currentLangBlock} / ${totalLangBlocks} ë¸”ë¡ (${percent}%)`;
                document.getElementById('progressDetails').textContent = 
                    `${langName} ë²ˆì—­ ì§„í–‰ ì¤‘...`;
                document.getElementById('overallProgress').textContent = 
                    `ì „ì²´ ì§„í–‰: ${langIndex + 1} / ${totalLangs} ì–¸ì–´`;
            }
        }

        // ì¼ì‹œì •ì§€ ë²„íŠ¼
        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPaused = true;
            pauseStartTime = Date.now();
            totalPauseStartTime = Date.now();
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('resumeBtn').style.display = 'block';
            document.getElementById('pauseNotice').style.display = 'block';
            document.getElementById('spinner').classList.add('paused');
        });

        // ì¬ê°œ ë²„íŠ¼
        document.getElementById('resumeBtn').addEventListener('click', () => {
            isPaused = false;
            if (pauseStartTime) {
                const pauseDuration = Date.now() - pauseStartTime;
                totalPausedTime += pauseDuration;
                totalPausedTime2 += pauseDuration;
                pauseStartTime = null;
                totalPauseStartTime = null;
            }
            document.getElementById('pauseBtn').style.display = 'block';
            document.getElementById('resumeBtn').style.display = 'none';
            document.getElementById('pauseNotice').style.display = 'none';
            document.getElementById('spinner').classList.remove('paused');
        });

        // ì·¨ì†Œ ë²„íŠ¼
        document.getElementById('cancelBtn').addEventListener('click', () => {
            if (confirm('ë²ˆì—­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì§„í–‰ ì¤‘ì¸ ì‘ì—…ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤.')) {
                isCancelled = true;
                stopTimer();
                document.getElementById('progressSection').style.display = 'none';
                document.getElementById('controlButtons').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
                alert('ë²ˆì—­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        });

        // API í‚¤ ì €ì¥ ë²„íŠ¼
        document.getElementById('saveKeyBtn').addEventListener('click', () => {
            const apiKey = document.getElementById('api_key').value.trim();
            if (!apiKey) {
                alert('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!apiKey.startsWith('sk-')) {
                alert('ì˜¬ë°”ë¥¸ OpenAI API í‚¤ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (sk-ë¡œ ì‹œì‘í•´ì•¼ í•¨)');
                return;
            }

            localStorage.setItem(API_KEY_STORAGE, apiKey);
            
            // ì…ë ¥ë€ ìˆ¨ê¸°ê³ , "ì €ì¥ë¨" ë±ƒì§€ì™€ "ìˆ˜ì •" ë²„íŠ¼ë§Œ í‘œì‹œ
            document.getElementById('apiKeyInputSection').style.display = 'none';
            document.getElementById('editKeyBtn').style.display = 'block';
            document.getElementById('savedBadge').style.display = 'inline-block';
            document.getElementById('cancelKeyBtn').style.display = 'none';
            
            alert('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        // API í‚¤ ìˆ˜ì • ë²„íŠ¼
        document.getElementById('editKeyBtn').addEventListener('click', () => {
            const apiKeyInputSection = document.getElementById('apiKeyInputSection');
            const apiKeyInput = document.getElementById('api_key');
            
            // ì…ë ¥ë€ ë³´ì´ê¸°
            apiKeyInputSection.style.display = 'block';
            apiKeyInput.disabled = false;
            apiKeyInput.focus();
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            document.getElementById('editKeyBtn').style.display = 'none';
            document.getElementById('savedBadge').style.display = 'none';
            document.getElementById('cancelKeyBtn').style.display = 'inline-block';
        });

        // API í‚¤ ì·¨ì†Œ ë²„íŠ¼ (ìƒˆë¡œ ì¶”ê°€)
        document.getElementById('cancelKeyBtn').addEventListener('click', () => {
            // ì €ì¥ëœ í‚¤ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
            const savedKey = localStorage.getItem(API_KEY_STORAGE);
            if (savedKey) {
                document.getElementById('api_key').value = savedKey;
            }
            
            // ì…ë ¥ë€ ë‹¤ì‹œ ìˆ¨ê¸°ê¸°
            document.getElementById('apiKeyInputSection').style.display = 'none';
            document.getElementById('editKeyBtn').style.display = 'block';
            document.getElementById('savedBadge').style.display = 'inline-block';
            document.getElementById('cancelKeyBtn').style.display = 'none';
        });

        // SRT íŒŒì‹± í•¨ìˆ˜ (ê°œì„ ëœ ë²„ì „)
        function parseSRT(content) {
            const blocks = [];
            
            // ì¤„ë°”ê¿ˆ í†µì¼ (\r\n -> \n)
            content = content.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            
            // ì—¬ëŸ¬ ê°œì˜ ë¹ˆ ì¤„ì„ 2ê°œë¡œ í†µì¼
            content = content.replace(/\n{3,}/g, '\n\n');
            
            // ë¹ˆ ì¤„ë¡œ ë¶„ë¦¬
            const rawBlocks = content.trim().split('\n\n');
            
            console.log(`ì›ë³¸ ë¸”ë¡ ë¶„ë¦¬: ${rawBlocks.length}ê°œ ë°œê²¬`);
            
            for (let i = 0; i < rawBlocks.length; i++) {
                const rawBlock = rawBlocks[i].trim();
                if (!rawBlock) continue;
                
                const lines = rawBlock.split('\n');
                
                // ìµœì†Œ 3ì¤„ì´ì–´ì•¼ í•¨ (ë²ˆí˜¸, íƒ€ì„ì½”ë“œ, í…ìŠ¤íŠ¸)
                if (lines.length < 3) {
                    console.log(`ë¸”ë¡ ${i} ìŠ¤í‚µ: ì¤„ ìˆ˜ ë¶€ì¡± (${lines.length}ì¤„)`);
                    continue;
                }
                
                // ì²« ë²ˆì§¸ ì¤„ì´ ìˆ«ìì¸ì§€ í™•ì¸
                const index = parseInt(lines[0].trim());
                if (isNaN(index)) {
                    console.log(`ë¸”ë¡ ${i} ìŠ¤í‚µ: ë¸”ë¡ ë²ˆí˜¸ê°€ ìˆ«ìê°€ ì•„ë‹˜ (${lines[0]})`);
                    continue;
                }
                
                // ë‘ ë²ˆì§¸ ì¤„ì´ íƒ€ì„ì½”ë“œ í˜•ì‹ì¸ì§€ í™•ì¸
                const timecode = lines[1].trim();
                if (!timecode.includes('-->')) {
                    console.log(`ë¸”ë¡ ${i} ìŠ¤í‚µ: íƒ€ì„ì½”ë“œ í˜•ì‹ ì˜¤ë¥˜ (${timecode})`);
                    continue;
                }
                
                // ë‚˜ë¨¸ì§€ ì¤„ì€ í…ìŠ¤íŠ¸
                const text = lines.slice(2).join('\n').trim();
                if (!text) {
                    console.log(`ë¸”ë¡ ${i} ìŠ¤í‚µ: í…ìŠ¤íŠ¸ ì—†ìŒ`);
                    continue;
                }
                
                blocks.push({ index, timecode, text });
            }
            
            console.log(`íŒŒì‹± ì™„ë£Œ: ${blocks.length}ê°œ ë¸”ë¡ ì„±ê³µ`);
            return blocks;
        }

        // SRT ìƒì„± í•¨ìˆ˜
        function generateSRT(blocks) {
            if (!Array.isArray(blocks)) {
                console.error('generateSRT: blocks is not an array', blocks);
                return '';
            }
            
            return blocks.map(block => {
                // 'timecode' ë˜ëŠ” 'time' ì†ì„± ë‘˜ ë‹¤ ì§€ì›
                const timeString = block.timecode || block.time || '00:00:00,000 --> 00:00:00,000';
                return `${block.index}\n${timeString}\n${block.text}\n`;
            }).join('\n');
        }

        // ë”œë ˆì´ í•¨ìˆ˜
        async function delay(ms) {
            // ì¼ì‹œì •ì§€ ì¤‘ì¼ ë•ŒëŠ” ëŒ€ê¸°
            while (isPaused && !isCancelled) {
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            // ì·¨ì†Œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì •ìƒ ë”œë ˆì´
            if (!isCancelled) {
                await new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // GPT API ë²ˆì—­ í•¨ìˆ˜
        async function translateText(apiKey, text, targetLanguage, maxRetries = 3) {
            if (isCancelled) throw new Error('ë²ˆì—­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            for (let attempt = 1; attempt <= maxRetries; attempt++) {
                if (isCancelled) throw new Error('ë²ˆì—­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [
                                {
                                    role: 'system',
                                    content: `You are a professional translator specialized in Korean to ${targetLanguage} translation.

CRITICAL RULES:
1. ONLY translate Korean text (í•œê¸€) to ${targetLanguage}
2. If you see English, numbers, special characters, or any non-Korean text, KEEP THEM EXACTLY AS THEY ARE
3. DO NOT translate English words or phrases under any circumstances
4. DO NOT add any explanation, notes, or commentary
5. Maintain the exact tone, style, and formatting of the original text
6. If the entire text is non-Korean, return it unchanged

Example:
Input: "ì•ˆë…•í•˜ì„¸ìš” Hello 123"
Output (to English): "Hello Hello 123"  (only ì•ˆë…•í•˜ì„¸ìš” is translated)

Now translate the following text:`
                                },
                                {
                                    role: 'user',
                                    content: text
                                }
                            ],
                            temperature: 0.3
                        })
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        
                        if (response.status === 429 && attempt < maxRetries) {
                            const waitTime = attempt * 2000;
                            console.log(`Rate limit hit. Waiting ${waitTime}ms...`);
                            await delay(waitTime);
                            continue;
                        }
                        
                        throw new Error(error.error?.message || `API ì˜¤ë¥˜ (${response.status})`);
                    }

                    const data = await response.json();
                    return data.choices[0].message.content.trim();
                    
                } catch (error) {
                    if (isCancelled) throw error;
                    console.error(`Translation attempt ${attempt} failed:`, error);
                    
                    if (attempt < maxRetries) {
                        await delay(1000 * attempt);
                        continue;
                    }
                    
                    throw error;
                }
            }
        }

        // ì „ì²´ ë¸”ë¡ ë²ˆì—­ í•¨ìˆ˜
        async function translateBlocks(apiKey, blocks, langCode, onProgress, isRetry = false) {
            const targetLanguage = LANGUAGES[langCode];
            const translatedBlocks = [];
            const errors = [];
            
            console.log(`${LANGUAGES[langCode]} ë²ˆì—­ ì‹œì‘ - ì´ ${blocks.length}ê°œ ë¸”ë¡`);
            
            for (let i = 0; i < blocks.length; i++) {
                if (isCancelled) throw new Error('ë²ˆì—­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                const block = blocks[i];
                // onProgress ì½œë°± í˜¸ì¶œ: (langCode, í˜„ì¬ë¸”ë¡, ì „ì²´ë¸”ë¡, ì—ëŸ¬ìˆ˜)
                if (onProgress) {
                    onProgress(langCode, i + 1, blocks.length, errors.length);
                }
                
                try {
                    const translatedText = await translateText(apiKey, block.text, targetLanguage);
                    translatedBlocks.push({
                        index: block.index,
                        timecode: block.timecode,
                        text: translatedText,
                        originalIndex: i
                    });
                    
                    await delay(100);
                    
                } catch (error) {
                    if (isCancelled) throw error;
                    console.error(`Block ${block.index} translation failed:`, error);
                    errors.push({
                        blockIndex: block.index,
                        originalIndex: i,
                        error: error.message
                    });
                    
                    translatedBlocks.push({
                        index: block.index,
                        timecode: block.timecode,
                        text: `[ë²ˆì—­ ì‹¤íŒ¨ - ì›ë³¸] ${block.text}`,
                        originalIndex: i,
                        failed: true
                    });
                    
                    await delay(500);
                }
            }
            
            return { translatedBlocks, errors };
        }

        // ê°œë³„ SRT íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        function downloadSRTFile(langCode, blocks) {
            const srtContent = generateSRT(blocks);
            const blob = new Blob([srtContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentFilename}_${langCode}.srt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log(`ë‹¤ìš´ë¡œë“œ ì™„ë£Œ: ${currentFilename}_${langCode}.srt`);
        }

        // ZIP íŒŒì¼ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ (ì¬ì‹œë„ìš©)
        async function downloadZipFile() {
            const zip = new JSZip();
            
            for (const langCode in translationResults) {
                const blocks = translationResults[langCode];
                const srtContent = generateSRT(blocks);
                zip.file(`${currentFilename}_${langCode}.srt`, srtContent);
            }
            
            const zipBlob = await zip.generateAsync({ type: 'blob' });
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            const downloadFilename = `${currentFilename}_translated_${timestamp}.zip`;
            
            const url = URL.createObjectURL(zipBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = downloadFilename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ì‹¤íŒ¨ ì •ë³´ í‘œì‹œ
        function showFailureInfo() {
            const totalFailed = Object.values(failedBlocks).reduce((sum, arr) => sum + arr.length, 0);
            
            if (totalFailed > 0) {
                const errorWarning = document.getElementById('errorWarning');
                const failureDetails = Object.entries(failedBlocks)
                    .filter(([_, indices]) => indices.length > 0)
                    .map(([langCode, indices]) => `${LANGUAGES[langCode]}: ${indices.length}ê°œ`)
                    .join('\n');
                
                errorWarning.innerHTML = `âš ï¸ <strong>${totalFailed}ê°œ ë¸”ë¡ ë²ˆì—­ ì‹¤íŒ¨</strong><br>${failureDetails.replace(/\n/g, '<br>')}`;
                errorWarning.style.display = 'block';
                
                document.getElementById('retryBtn').style.display = 'block';
                
                return true;
            }
            return false;
        }

        // ì¬ì‹œë„ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('retryBtn').addEventListener('click', async function() {
            const apiKey = document.getElementById('api_key').value.trim();
            const submitBtn = document.getElementById('submitBtn');
            const retryBtn = document.getElementById('retryBtn');
            const progressSection = document.getElementById('progressSection');
            const errorSection = document.getElementById('errorSection');
            const controlButtons = document.getElementById('controlButtons');
            const errorWarning = document.getElementById('errorWarning');
            const retryInfo = document.getElementById('retryInfo');
            
            // ì œì–´ ë³€ìˆ˜ ì´ˆê¸°í™”
            isPaused = false;
            isCancelled = false;
            
            submitBtn.disabled = true;
            retryBtn.disabled = true;
            progressSection.style.display = 'block';
            controlButtons.style.display = 'flex';
            errorSection.style.display = 'none';
            errorWarning.style.display = 'none';
            document.getElementById('pauseNotice').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'block';
            document.getElementById('resumeBtn').style.display = 'none';
            
            // íƒ€ì´ë¨¸ ì‹œì‘
            startTimer();
            
            const totalToRetry = Object.values(failedBlocks).reduce((sum, arr) => sum + arr.length, 0);
            retryInfo.innerHTML = `ğŸ”„ <strong>${totalToRetry}ê°œ ì‹¤íŒ¨ ë¸”ë¡ ì¬ì‹œë„ ì¤‘...</strong>`;
            retryInfo.style.display = 'block';
            
            try {
                const newFailedBlocks = {};
                const langCodesToRetry = Object.keys(failedBlocks).filter(code => failedBlocks[code].length > 0);
                
                for (let i = 0; i < langCodesToRetry.length; i++) {
                    const langCode = langCodesToRetry[i];
                    if (isCancelled) break;
                    
                    const langName = LANGUAGES[langCode];
                    const failedIndices = failedBlocks[langCode];
                    const blocksToRetry = failedIndices.map(idx => originalBlocks[idx]);
                    
                    const result = await translateBlocks(
                        apiKey,
                        blocksToRetry,
                        langCode,
                        (code, current, total, errorCount) => {
                            updateProgress(current, total, langName, i, langCodesToRetry.length);
                        },
                        true
                    );
                    
                    result.translatedBlocks.forEach((block, idx) => {
                        const originalIdx = failedIndices[idx];
                        translationResults[langCode][originalIdx] = block;
                    });
                    
                    newFailedBlocks[langCode] = result.errors.map(e => failedIndices[e.originalIndex]);
                }
                
                if (isCancelled) {
                    return;
                }
                
                stopTimer();
                failedBlocks = newFailedBlocks;
                progressSection.style.display = 'none';
                controlButtons.style.display = 'none';
                retryInfo.style.display = 'none';
                
                const stillFailed = showFailureInfo();
                await downloadZipFile();
                
                if (stillFailed) {
                    const remainingFailed = Object.values(failedBlocks).reduce((sum, arr) => sum + arr.length, 0);
                    alert(`âš ï¸ ì¬ì‹œë„ ì™„ë£Œ!\n\ní•˜ì§€ë§Œ ì—¬ì „íˆ ${remainingFailed}ê°œ ë¸”ë¡ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\në‹¤ì‹œ ì¬ì‹œë„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.`);
                } else {
                    alert('âœ… ëª¨ë“  ë¸”ë¡ ë²ˆì—­ ì„±ê³µ!\n\nZIP íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.');
                    retryBtn.style.display = 'none';
                    errorWarning.style.display = 'none';
                }
                
            } catch (error) {
                if (error.message === 'ë²ˆì—­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.') {
                    return;
                }
                console.error('Retry error:', error);
                stopTimer();
                progressSection.style.display = 'none';
                controlButtons.style.display = 'none';
                errorSection.style.display = 'block';
                document.getElementById('errorText').textContent = error.message;
            } finally {
                submitBtn.disabled = false;
                retryBtn.disabled = false;
            }
        });

        // ========================================
        // 1. í™”ìëª… ë³€ê²½ëœ ë²ˆì—­
        // ========================================
        
        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
        const speakerSrtFilesInput = document.getElementById('speaker_srt_files');
        const speakerSrtFileNames = document.getElementById('speaker-srt-file-names');
        
        speakerSrtFilesInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                const names = Array.from(this.files).map(f => f.name).join(', ');
                speakerSrtFileNames.textContent = 
                    this.files.length === 1 ? this.files[0].name : `${this.files.length}ê°œ íŒŒì¼ ì„ íƒë¨`;
            } else {
                speakerSrtFileNames.textContent = 'SRT íŒŒì¼ ì„ íƒ (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)';
            }
        });


        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const speakerSrtFilesWrapper = document.getElementById('speakerSrtFilesWrapper');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            speakerSrtFilesWrapper.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
            });
        });
        
        ['dragenter', 'dragover'].forEach(eventName => {
            speakerSrtFilesWrapper.addEventListener(eventName, () => {
                speakerSrtFilesWrapper.classList.add('drag-over');
            });
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            speakerSrtFilesWrapper.addEventListener(eventName, () => {
                speakerSrtFilesWrapper.classList.remove('drag-over');
            });
        });
        
        speakerSrtFilesWrapper.addEventListener('drop', function(e) {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                speakerSrtFilesInput.files = files;
                const names = Array.from(files).map(f => f.name).join(', ');
                speakerSrtFileNames.textContent = 
                    files.length === 1 ? files[0].name : `${files.length}ê°œ íŒŒì¼ ì„ íƒë¨`;
            }
        });

        // í™”ìëª… ë²ˆì—­ ì „ìš© ë³€ìˆ˜
        let speakerIsPaused = false;
        let speakerIsCancelled = false;
        let speakerStartTime = null;
        let speakerPauseStartTime = null;
        let speakerTotalPausedTime = 0;
        let speakerTimerInterval = null;
        let speakerCurrentBlocksTotal = 0;
        let speakerCurrentBlocksCompleted = 0;
        let speakerTotalStartTime = null;
        let speakerTotalPausedTime2 = 0;
        let speakerTotalPauseStartTime = null;

        // í™”ìëª… ë²ˆì—­ íƒ€ì´ë¨¸ ì‹œì‘
        function startSpeakerTimer() {
            speakerStartTime = Date.now();
            speakerTotalPausedTime = 0;
            speakerTimerInterval = setInterval(() => {
                if (!speakerIsPaused) {
                    const elapsed = Date.now() - speakerStartTime - speakerTotalPausedTime;
                    document.getElementById('speakerTimer').textContent = `â±ï¸ ${formatTime(elapsed)}`;
                    
                    const totalElapsed = Date.now() - speakerTotalStartTime - speakerTotalPausedTime2;
                    document.getElementById('speakerTimerTotal').textContent = `ğŸ• ${formatTime(totalElapsed)}`;
                    
                    updateSpeakerRemainingTime(elapsed, totalElapsed);
                }
            }, 1000);
        }

        // í™”ìëª… ë²ˆì—­ ë‚¨ì€ ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateSpeakerRemainingTime(elapsed, totalElapsed) {
            if (speakerCurrentBlocksCompleted > 10 && speakerCurrentBlocksTotal > 0) {
                const avgTimePerBlock = elapsed / speakerCurrentBlocksCompleted;
                const remainingBlocks = speakerCurrentBlocksTotal - speakerCurrentBlocksCompleted;
                const estimatedRemaining = avgTimePerBlock * remainingBlocks;
                
                document.getElementById('speakerTimerRemaining').style.display = 'block';
                document.getElementById('speakerTimerRemaining').textContent = `â³ ${formatTime(estimatedRemaining)}`;
            }
        }

        // í™”ìëª… ë²ˆì—­ íƒ€ì´ë¨¸ ì¤‘ì§€
        function stopSpeakerTimer() {
            if (speakerTimerInterval) {
                clearInterval(speakerTimerInterval);
                speakerTimerInterval = null;
            }
        }

        // í™”ìëª… ë²ˆì—­ ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSpeakerProgress(fileName, current, total, fileIndex, totalFiles) {
            const percentage = Math.round((current / total) * 100);
            
            document.getElementById('speakerProgressText').textContent = 
                `${fileName}: ${current} / ${total} ë¸”ë¡ (${percentage}%)`;
            
            document.getElementById('speakerProgressDetails').textContent = 
                `íŒŒì¼ ì§„í–‰: ${fileIndex} / ${totalFiles}`;
            
            document.getElementById('speakerProgressBar').style.width = `${percentage}%`;
            document.getElementById('speakerProgressBar').textContent = `${percentage}%`;
        }

        // í™”ìëª… ë²ˆì—­ ì‹œì‘ ë²„íŠ¼
        document.getElementById('speakerTranslateBtn').addEventListener('click', async function() {
            const files = speakerSrtFilesInput.files;
            
            if (!files || files.length === 0) {
                alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ SRT íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }

            const apiKey = document.getElementById('api_key').value.trim();
            if (!apiKey) {
                alert('API í‚¤ë¥¼ ì…ë ¥ ë˜ëŠ” ì €ì¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!apiKey.startsWith('sk-')) {
                alert('ì˜¬ë°”ë¥¸ OpenAI API í‚¤ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (sk-ë¡œ ì‹œì‘í•´ì•¼ í•¨)');
                return;
            }

            // ìƒíƒœ ì´ˆê¸°í™”
            speakerIsPaused = false;
            speakerIsCancelled = false;
            speakerTotalStartTime = Date.now();
            speakerTotalPausedTime2 = 0;

            // UI ì´ˆê¸°í™”
            const progressSection = document.getElementById('speakerProgressSection');
            const errorSection = document.getElementById('speakerErrorSection');
            const controlButtons = document.getElementById('speakerControlButtons');
            
            progressSection.style.display = 'block';
            errorSection.style.display = 'none';
            controlButtons.style.display = 'flex';
            this.disabled = true;

            try {
                // ê° íŒŒì¼ì— ëŒ€í•´ ë²ˆì—­ ì§„í–‰
                for (let i = 0; i < files.length; i++) {
                    if (speakerIsCancelled) break;

                    const file = files[i];
                    const content = await file.text();
                    const blocks = parseSRT(content);
                    
                    if (blocks.length === 0) {
                        alert(`${file.name}: SRT íŒŒì¼ì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                        continue;
                    }

                    // ê°œë³„ íŒŒì¼ íƒ€ì´ë¨¸ ì‹œì‘
                    startSpeakerTimer();
                    speakerCurrentBlocksTotal = blocks.length;
                    speakerCurrentBlocksCompleted = 0;

                    // íŒŒì¼ì˜ ì–¸ì–´ ê°ì§€ (íŒŒì¼ëª… ê¸°ë°˜)
                    let targetLanguage = 'English'; // ê¸°ë³¸ê°’
                    const fileName = file.name.toLowerCase();
                    
                    if (fileName.includes('ì˜ì–´') || fileName.includes('english')) {
                        targetLanguage = 'English';
                    } else if (fileName.includes('ì¼ë³¸') || fileName.includes('japanese')) {
                        targetLanguage = 'Japanese';
                    } else if (fileName.includes('ì¤‘êµ­') || fileName.includes('chinese')) {
                        targetLanguage = 'Chinese (Simplified)';
                    } else if (fileName.includes('ë²ˆì²´') || fileName.includes('traditional')) {
                        targetLanguage = 'Chinese (Traditional)';
                    } else if (fileName.includes('íƒœêµ­') || fileName.includes('thai')) {
                        targetLanguage = 'Thai';
                    } else if (fileName.includes('ìŠ¤í˜ì¸') || fileName.includes('spanish')) {
                        targetLanguage = 'Spanish';
                    } else if (fileName.includes('ì¸ë„ë„¤ì‹œì•„') || fileName.includes('indonesian')) {
                        targetLanguage = 'Indonesian';
                    }

                    // ë¸”ë¡ë³„ë¡œ ë²ˆì—­
                    const translatedBlocks = [];
                    let errorCount = 0;

                    for (let j = 0; j < blocks.length; j++) {
                        // ì¼ì‹œì •ì§€ í™•ì¸
                        while (speakerIsPaused && !speakerIsCancelled) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }

                        if (speakerIsCancelled) break;

                        const block = blocks[j];
                        
                        // í•œê¸€ ê°ì§€ ì •ê·œì‹ (ììŒ, ëª¨ìŒ, ì™„ì„±í˜• í•œê¸€ ëª¨ë‘ í¬í•¨)
                        const koreanRegex = /[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/;
                        
                        // ì¬ì‹œë„ ë¡œì§ (ë²ˆì—­ì´ ì„±ê³µí•˜ê³  í•œê¸€ì´ ì—†ì„ ë•Œê¹Œì§€)
                        let translatedText = null;
                        let retryCount = 0;
                        const maxAutoRetries = 10; // ìµœëŒ€ ìë™ ì¬ì‹œë„ íšŸìˆ˜
                        const maxKoreanRetries = 5; // í•œê¸€ ì²´í¬ í›„ ìµœëŒ€ ì¬ë²ˆì—­ íšŸìˆ˜
                        
                        while (translatedText === null && !speakerIsCancelled) {
                            try {
                                translatedText = await translateText(apiKey, block.text, targetLanguage);
                                
                                // ë²ˆì—­ ì„±ê³µ í›„ í•œê¸€ì´ ìˆëŠ”ì§€ ì²´í¬
                                if (translatedText && koreanRegex.test(translatedText)) {
                                    console.warn(`ë¸”ë¡ ${block.index}: ë²ˆì—­ ê²°ê³¼ì— í•œê¸€ ë°œê²¬: "${translatedText}"`);
                                    
                                    // í•œê¸€ ì¬ë²ˆì—­ ì‹œë„ (ì›ë³¸ í…ìŠ¤íŠ¸ë¥¼ ê°•ë ¥í•œ í”„ë¡¬í”„íŠ¸ë¡œ ì¬ë²ˆì—­)
                                    let koreanRetryCount = 0;
                                    let cleanTranslation = null;
                                    
                                    while (koreanRetryCount < maxKoreanRetries && !speakerIsCancelled) {
                                        koreanRetryCount++;
                                        console.log(`ë¸”ë¡ ${block.index}: í•œê¸€ ì™„ì „ ì œê±° ì¬ë²ˆì—­ ${koreanRetryCount}/${maxKoreanRetries}`);
                                        
                                        try {
                                            // ê°•ë ¥í•œ í”„ë¡¬í”„íŠ¸ë¡œ ì›ë³¸ì„ ë‹¤ì‹œ ë²ˆì—­
                                            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                    'Authorization': `Bearer ${apiKey}`
                                                },
                                                body: JSON.stringify({
                                                    model: 'gpt-4o-mini',
                                                    messages: [
                                                        {
                                                            role: 'system',
                                                            content: `You are a professional translator. CRITICAL RULES:

1. You MUST translate ALL Korean text (í•œê¸€) to ${targetLanguage}
2. DO NOT leave any Korean characters in the result
3. If you see proper nouns (like "His man"), keep them in English but translate ALL surrounding Korean text
4. Even single Korean words or particles MUST be translated
5. Your output should contain ZERO Korean characters (ã„±-ã…, ã…-ã…£, ê°€-í£)
6. If the text contains English or other non-Korean languages, keep them as they are

Example:
Input: "ì§„ì •í•œ ì‚¬ë‘ì„ ì°¾ê¸° ìœ„í•´ His man ì´ê³³ìœ¼ë¡œ ëª¨ì˜€ëŠ”ë°ìš”"
Output (to Spanish): "Para encontrar el amor verdadero, nos reunimos aquÃ­ en His man"

Now translate the following Korean text to ${targetLanguage}. Remember: NO Korean characters should remain in your translation.`
                                                        },
                                                        {
                                                            role: 'user',
                                                            content: block.text  // ì›ë³¸ í…ìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ë²ˆì—­
                                                        }
                                                    ],
                                                    temperature: 0.3
                                                })
                                            });

                                            if (response.ok) {
                                                const data = await response.json();
                                                cleanTranslation = data.choices[0].message.content.trim();
                                                
                                                // ì¬ë²ˆì—­ ê²°ê³¼ì— í•œê¸€ì´ ìˆëŠ”ì§€ ì²´í¬
                                                if (cleanTranslation && !koreanRegex.test(cleanTranslation)) {
                                                    console.log(`ë¸”ë¡ ${block.index}: í•œê¸€ ì œê±° ì„±ê³µ! "${cleanTranslation}"`);
                                                    translatedText = cleanTranslation;
                                                    break; // í•œê¸€ì´ ì—†ìœ¼ë©´ ì„±ê³µ
                                                } else if (cleanTranslation) {
                                                    console.warn(`ë¸”ë¡ ${block.index}: ì¬ë²ˆì—­ ${koreanRetryCount}íšŒ í›„ì—ë„ í•œê¸€ ì¡´ì¬: "${cleanTranslation}"`);
                                                    translatedText = cleanTranslation; // ìµœì‹  ê²°ê³¼ ìœ ì§€
                                                }
                                            } else {
                                                console.error(`ë¸”ë¡ ${block.index}: API ì˜¤ë¥˜ (${response.status})`);
                                            }
                                            
                                            // ì ì‹œ ëŒ€ê¸°
                                            await new Promise(resolve => setTimeout(resolve, 1000));
                                        } catch (retryError) {
                                            console.error(`ë¸”ë¡ ${block.index}: í•œê¸€ ì¬ë²ˆì—­ ì‹¤íŒ¨:`, retryError);
                                            await new Promise(resolve => setTimeout(resolve, 2000));
                                        }
                                    }
                                    
                                    // ìµœëŒ€ ì¬ì‹œë„ í›„ì—ë„ í•œê¸€ì´ ë‚¨ì•„ìˆìœ¼ë©´ ì›ë³¸ì„ í•œ ë²ˆ ë” ì‹œë„
                                    if (koreanRegex.test(translatedText)) {
                                        console.error(`ë¸”ë¡ ${block.index}: ${maxKoreanRetries}íšŒ í›„ì—ë„ í•œê¸€ ë‚¨ìŒ. ìµœì¢… ì‹œë„...`);
                                        
                                        try {
                                            // ë§ˆì§€ë§‰ ì‹œë„: ë§¤ìš° ê°•ë ¥í•œ í”„ë¡¬í”„íŠ¸
                                            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                    'Authorization': `Bearer ${apiKey}`
                                                },
                                                body: JSON.stringify({
                                                    model: 'gpt-4o-mini',
                                                    messages: [
                                                        {
                                                            role: 'system',
                                                            content: `EMERGENCY TRANSLATION MODE: You MUST translate ALL Korean to ${targetLanguage}. NO Korean characters (í•œê¸€) should appear in output. This is critical.`
                                                        },
                                                        {
                                                            role: 'user',
                                                            content: `Translate this to ${targetLanguage}, removing ALL Korean: ${block.text}`
                                                        }
                                                    ],
                                                    temperature: 0.5
                                                })
                                            });

                                            if (response.ok) {
                                                const data = await response.json();
                                                const finalAttempt = data.choices[0].message.content.trim();
                                                
                                                if (finalAttempt && !koreanRegex.test(finalAttempt)) {
                                                    console.log(`ë¸”ë¡ ${block.index}: ìµœì¢… ì‹œë„ ì„±ê³µ!`);
                                                    translatedText = finalAttempt;
                                                } else {
                                                    console.error(`ë¸”ë¡ ${block.index}: ëª¨ë“  ì‹œë„ ì‹¤íŒ¨. í•œê¸€ ì—¬ì „íˆ ì¡´ì¬.`);
                                                    errorCount++;
                                                }
                                            }
                                        } catch (finalError) {
                                            console.error(`ë¸”ë¡ ${block.index}: ìµœì¢… ì‹œë„ ì‹¤íŒ¨:`, finalError);
                                            errorCount++;
                                        }
                                    }
                                }
                                
                                break; // ë²ˆì—­ ì™„ë£Œ (í•œê¸€ ì²´í¬ ì™„ë£Œ)
                                
                            } catch (error) {
                                retryCount++;
                                console.error(`ë¸”ë¡ ${block.index} ë²ˆì—­ ì‹¤íŒ¨ (${retryCount}ë²ˆì§¸ ì‹œë„):`, error);
                                
                                if (retryCount >= maxAutoRetries) {
                                    console.error(`ë¸”ë¡ ${block.index}: ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜(${maxAutoRetries}) ë„ë‹¬. ì›ë³¸ ì‚¬ìš©.`);
                                    translatedText = `[ë²ˆì—­ ì‹¤íŒ¨ - ì›ë³¸] ${block.text}`;
                                    errorCount++;
                                    break;
                                }
                                
                                // ì¬ì‹œë„ ì „ ëŒ€ê¸° (ì§€ìˆ˜ ë°±ì˜¤í”„)
                                const waitTime = Math.min(1000 * Math.pow(2, retryCount - 1), 30000); // ìµœëŒ€ 30ì´ˆ
                                console.log(`${waitTime}ms í›„ ì¬ì‹œë„...`);
                                await new Promise(resolve => setTimeout(resolve, waitTime));
                            }
                        }

                        if (speakerIsCancelled) break;

                        translatedBlocks.push({
                            index: block.index,
                            timecode: block.timecode,  // 'time' â†’ 'timecode'ë¡œ ë³€ê²½
                            text: translatedText
                        });

                        speakerCurrentBlocksCompleted = j + 1;
                        updateSpeakerProgress(file.name, j + 1, blocks.length, i + 1, files.length);

                        // API í˜¸ì¶œ ê°„ ë”œë ˆì´
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }

                    if (speakerIsCancelled) break;

                    // íƒ€ì´ë¨¸ ì¤‘ì§€
                    stopSpeakerTimer();

                    // ê°œë³„ íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ì›ë³¸ íŒŒì¼ëª… ìœ ì§€)
                    const srtContent = generateSRT(translatedBlocks);
                    const blob = new Blob([srtContent], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'ë²ˆì—­ì™„ë£Œ/' + file.name;  // "ë²ˆì—­ì™„ë£Œ" í´ë” ì•ˆì— ì €ì¥
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    if (errorCount > 0) {
                        console.log(`${file.name}: ${errorCount}ê°œ ë¸”ë¡ ë²ˆì—­ ì‹¤íŒ¨`);
                    }
                }

                // ì„±ê³µ ë©”ì‹œì§€
                if (!speakerIsCancelled) {
                    progressSection.style.display = 'none';
                    controlButtons.style.display = 'none';
                    alert(`ëª¨ë“  íŒŒì¼ ë²ˆì—­ ì™„ë£Œ! (${files.length}ê°œ íŒŒì¼)`);
                }

            } catch (error) {
                console.error('ë²ˆì—­ ì˜¤ë¥˜:', error);
                stopSpeakerTimer();
                progressSection.style.display = 'none';
                controlButtons.style.display = 'none';
                errorSection.style.display = 'block';
                document.getElementById('speakerErrorText').textContent = error.message;
            } finally {
                this.disabled = false;
                stopSpeakerTimer();
            }
        });

        // í™”ìëª… ë²ˆì—­ ì¼ì‹œì •ì§€ ë²„íŠ¼
        document.getElementById('speakerPauseBtn').addEventListener('click', () => {
            speakerIsPaused = true;
            speakerPauseStartTime = Date.now();
            speakerTotalPauseStartTime = Date.now();
            document.getElementById('speakerPauseBtn').style.display = 'none';
            document.getElementById('speakerResumeBtn').style.display = 'block';
            document.getElementById('speakerPauseNotice').style.display = 'block';
            document.getElementById('speakerSpinner').classList.add('paused');
        });

        // í™”ìëª… ë²ˆì—­ ì¬ê°œ ë²„íŠ¼
        document.getElementById('speakerResumeBtn').addEventListener('click', () => {
            speakerIsPaused = false;
            if (speakerPauseStartTime) {
                const pauseDuration = Date.now() - speakerPauseStartTime;
                speakerTotalPausedTime += pauseDuration;
                speakerTotalPausedTime2 += pauseDuration;
                speakerPauseStartTime = null;
                speakerTotalPauseStartTime = null;
            }
            document.getElementById('speakerPauseBtn').style.display = 'block';
            document.getElementById('speakerResumeBtn').style.display = 'none';
            document.getElementById('speakerPauseNotice').style.display = 'none';
            document.getElementById('speakerSpinner').classList.remove('paused');
        });

        // í™”ìëª… ë²ˆì—­ ì·¨ì†Œ ë²„íŠ¼
        document.getElementById('speakerCancelBtn').addEventListener('click', () => {
            if (confirm('ë²ˆì—­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì§„í–‰ ì¤‘ì¸ ì‘ì—…ì´ ì¤‘ë‹¨ë©ë‹ˆë‹¤.')) {
                speakerIsCancelled = true;
                stopSpeakerTimer();
                document.getElementById('speakerProgressSection').style.display = 'none';
                document.getElementById('speakerControlButtons').style.display = 'none';
                document.getElementById('speakerTranslateBtn').disabled = false;
                alert('ë²ˆì—­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ========================================
        // 2. ì „ì²´ ë²ˆì—­
        // ========================================

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
        const fileInput = document.getElementById('srt_file');
        const fileNameDisplay = document.getElementById('file-name');
        
        fileInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                fileNameDisplay.textContent = 
                    this.files.length === 1 ? this.files[0].name : `${this.files.length}ê°œ íŒŒì¼ ì„ íƒë¨`;
            } else {
                fileNameDisplay.textContent = 'íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš” (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)';
            }
        });

        // ì „ì²´ ì„ íƒ/í•´ì œ
        document.getElementById('selectAll').addEventListener('click', function() {
            document.querySelectorAll('input[name="languages"]').forEach(checkbox => {
                checkbox.checked = true;
            });
        });

        document.getElementById('deselectAll').addEventListener('click', function() {
            document.querySelectorAll('input[name="languages"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        });

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const fileUploadWrapper = document.getElementById('fullTranslateWrapper');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileUploadWrapper.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
            });
        });
        
        ['dragenter', 'dragover'].forEach(eventName => {
            fileUploadWrapper.addEventListener(eventName, () => {
                fileUploadWrapper.classList.add('drag-over');
            });
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            fileUploadWrapper.addEventListener(eventName, () => {
                fileUploadWrapper.classList.remove('drag-over');
            });
        });
        
        fileUploadWrapper.addEventListener('drop', function(e) {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                fileNameDisplay.textContent = 
                    files.length === 1 ? files[0].name : `${files.length}ê°œ íŒŒì¼ ì„ íƒë¨`;
            }
        });

        // í¼ ì œì¶œ
        document.getElementById('translationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const retryBtn = document.getElementById('retryBtn');
            const progressSection = document.getElementById('progressSection');
            const errorSection = document.getElementById('errorSection');
            const controlButtons = document.getElementById('controlButtons');
            const errorWarning = document.getElementById('errorWarning');
            
            // ì œì–´ ë³€ìˆ˜ ì´ˆê¸°í™”
            isPaused = false;
            isCancelled = false;
            
            submitBtn.disabled = true;
            retryBtn.style.display = 'none';
            progressSection.style.display = 'block';
            controlButtons.style.display = 'flex';
            errorSection.style.display = 'none';
            errorWarning.style.display = 'none';
            document.getElementById('pauseNotice').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'block';
            document.getElementById('resumeBtn').style.display = 'none';
            
            translationResults = {};
            failedBlocks = {};
            
            // ì „ì²´ íƒ€ì´ë¨¸ ì‹œì‘
            startTotalTimer();
            
            // ê°œë³„ íƒ€ì´ë¨¸ ì‹œì‘
            startTimer();
            
            try {
                const apiKey = document.getElementById('api_key').value.trim();
                if (!apiKey) {
                    throw new Error('API í‚¤ë¥¼ ì…ë ¥ ë˜ëŠ” ì €ì¥í•´ì£¼ì„¸ìš”.');
                }
                
                const files = fileInput.files;
                if (!files || files.length === 0) {
                    throw new Error('SRT íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                }
                
                selectedLanguages = Array.from(
                    document.querySelectorAll('input[name="languages"]:checked')
                ).map(cb => cb.value);
                
                if (selectedLanguages.length === 0) {
                    throw new Error('ìµœì†Œ í•˜ë‚˜ì˜ ì–¸ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                }

                let totalFilesProcessed = 0;
                let totalTranslationsCompleted = 0;

                // ê° íŒŒì¼ì— ëŒ€í•´ ì²˜ë¦¬
                for (let fileIdx = 0; fileIdx < files.length; fileIdx++) {
                    if (isCancelled) break;

                    const file = files[fileIdx];
                    const fileContent = await file.text();
                    originalBlocks = parseSRT(fileContent);
                    
                    if (originalBlocks.length === 0) {
                        alert(`${file.name}: SRT íŒŒì¼ì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                        continue;
                    }
                    
                    console.log(`[${file.name}] íŒŒì‹±ëœ ë¸”ë¡ ìˆ˜: ${originalBlocks.length}`);
                    currentFilename = file.name.replace('.srt', '');
                    
                    // ê° ì–¸ì–´ë³„ë¡œ ë²ˆì—­
                    for (let langIdx = 0; langIdx < selectedLanguages.length; langIdx++) {
                        if (isCancelled) break;
                        
                        const langCode = selectedLanguages[langIdx];
                        const langName = LANGUAGES[langCode];
                        
                        // íƒ€ì´ë¨¸ ë¦¬ì…‹ (ê° ì–¸ì–´ë§ˆë‹¤ ìƒˆë¡œ ì‹œì‘)
                        currentLangCompletedBlocks = 0;
                        startTime = Date.now();
                        totalPausedTime = 0;
                        
                        const result = await translateBlocks(
                            apiKey, 
                            originalBlocks, 
                            langCode,
                            (code, current, total, errorCount) => {
                                // ì§„í–‰ ìƒíƒœì— íŒŒì¼ ì •ë³´ ì¶”ê°€
                                document.getElementById('progressText').textContent = 
                                    `${langName}: ${current} / ${total} ë¸”ë¡ (${Math.round((current/total)*100)}%)`;
                                document.getElementById('progressDetails').textContent = 
                                    `íŒŒì¼: ${fileIdx + 1} / ${files.length} | ì–¸ì–´: ${langIdx + 1} / ${selectedLanguages.length}`;
                                currentLangCompletedBlocks = current;
                                currentLangTotalBlocks = total;
                            }
                        );
                        
                        translationResults[langCode] = result.translatedBlocks;
                        failedBlocks[langCode] = result.errors.map(e => e.originalIndex);
                        
                        // ê° ì–¸ì–´ ë²ˆì—­ ì™„ë£Œ ì¦‰ì‹œ ë‹¤ìš´ë¡œë“œ (íŒŒì¼ëª…_ì–¸ì–´ëª….srt í˜•ì‹)
                        if (!isCancelled) {
                            const outputFilename = `${currentFilename}_${langName.split(' ')[0]}.srt`;
                            const srtContent = generateSRT(result.translatedBlocks);
                            downloadSRTFile(outputFilename, srtContent);
                            
                            totalTranslationsCompleted++;
                            
                            // ì™„ë£Œ ì•Œë¦¼
                            document.getElementById('progressDetails').textContent = 
                                `âœ… ${file.name} â†’ ${langName} ë²ˆì—­ ì™„ë£Œ!`;
                            
                            // ì ì‹œ ëŒ€ê¸° (ì‚¬ìš©ìê°€ ì•Œë¦¼ ë³¼ ìˆ˜ ìˆë„ë¡)
                            await delay(500);
                        }
                    }

                    totalFilesProcessed++;
                }
                
                if (isCancelled) {
                    return;
                }
                
                stopTimer();
                progressSection.style.display = 'none';
                controlButtons.style.display = 'none';
                
                let message = `âœ… ëª¨ë“  ë²ˆì—­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\n${totalFilesProcessed}ê°œ íŒŒì¼ Ã— ${selectedLanguages.length}ê°œ ì–¸ì–´ = ì´ ${totalTranslationsCompleted}ê°œ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`;
                alert(message);
                
            } catch (error) {
                if (error.message === 'ë²ˆì—­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.') {
                    return;
                }
                console.error('Error:', error);
                stopTimer();
                progressSection.style.display = 'none';
                controlButtons.style.display = 'none';
                errorSection.style.display = 'block';
                document.getElementById('errorText').textContent = error.message;
            } finally {
                submitBtn.disabled = false;
            }
        });

        // ========================================
        // 3. ê²€í†  (ë¸”ë¡ë²ˆí˜¸, í•œê¸€) ê¸°ëŠ¥
        // ========================================

        const reviewFilesInput = document.getElementById('review_files');
        const reviewFileNames = document.getElementById('review-file-names');
        const reviewBtn = document.getElementById('reviewBtn');
        const reviewResultSection = document.getElementById('reviewResultSection');
        const reviewResultContent = document.getElementById('reviewResultContent');
        const reviewErrorSection = document.getElementById('reviewErrorSection');
        const reviewErrorText = document.getElementById('reviewErrorText');
        const downloadReviewLogBtn = document.getElementById('downloadReviewLogBtn');

        let reviewLogContent = '';

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
        reviewFilesInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                reviewFileNames.textContent = 
                    this.files.length === 1 ? this.files[0].name : `${this.files.length}ê°œ íŒŒì¼ ì„ íƒë¨`;
            } else {
                reviewFileNames.textContent = 'íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš” (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)';
            }
        });

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const reviewFilesWrapper = document.getElementById('reviewFilesWrapper');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            reviewFilesWrapper.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
            });
        });
        
        ['dragenter', 'dragover'].forEach(eventName => {
            reviewFilesWrapper.addEventListener(eventName, () => {
                reviewFilesWrapper.classList.add('drag-over');
            });
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            reviewFilesWrapper.addEventListener(eventName, () => {
                reviewFilesWrapper.classList.remove('drag-over');
            });
        });
        
        reviewFilesWrapper.addEventListener('drop', function(e) {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                reviewFilesInput.files = files;
                reviewFileNames.textContent = 
                    files.length === 1 ? files[0].name : `${files.length}ê°œ íŒŒì¼ ì„ íƒë¨`;
            }
        });

        // ê²€í†  ì‹œì‘ ë²„íŠ¼
        reviewBtn.addEventListener('click', async function() {
            const files = reviewFilesInput.files;
            
            if (!files || files.length === 0) {
                alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ SRT íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }

            // UI ì´ˆê¸°í™”
            reviewErrorSection.style.display = 'none';
            reviewResultSection.style.display = 'none';
            reviewBtn.disabled = true;
            reviewBtn.textContent = 'ğŸ” ê²€í†  ì¤‘...';

            try {
                const koreanRegex = /[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/;
                let logText = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
                logText += '       SRT íŒŒì¼ ê²€í†  ê²°ê³¼\n';
                logText += `       ìƒì„± ì‹œê°„: ${new Date().toLocaleString('ko-KR')}\n`;
                logText += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';

                let totalFiles = files.length;
                let totalKoreanBlocks = 0;

                // ê° íŒŒì¼ ê²€í† 
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const content = await file.text();
                    const blocks = parseSRT(content);

                    logText += `\nğŸ“„ íŒŒì¼ ${i + 1}/${totalFiles}: ${file.name}\n`;
                    logText += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';

                    if (blocks.length === 0) {
                        logText += '  âš ï¸ íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨\n';
                        logText += '  ë¸”ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n';
                        continue;
                    }

                    // ë§ˆì§€ë§‰ ë¸”ë¡ ë²ˆí˜¸
                    const lastBlock = blocks[blocks.length - 1];
                    logText += `  ğŸ“Š ì´ ë¸”ë¡ ìˆ˜: ${blocks.length}ê°œ\n`;
                    logText += `  ğŸ”¢ ë§ˆì§€ë§‰ ë¸”ë¡ë²ˆí˜¸: ${lastBlock.index}\n`;

                    // í•œê¸€ì´ ìˆëŠ” ë¸”ë¡ ì°¾ê¸°
                    const koreanBlocks = [];
                    for (const block of blocks) {
                        if (koreanRegex.test(block.text)) {
                            koreanBlocks.push({
                                index: block.index,
                                text: block.text
                            });
                        }
                    }

                    if (koreanBlocks.length > 0) {
                        logText += `  âš ï¸ í•œê¸€ ë°œê²¬: ${koreanBlocks.length}ê°œ ë¸”ë¡\n\n`;
                        
                        koreanBlocks.forEach((kb, idx) => {
                            logText += `  ${idx + 1}. ë¸”ë¡ ${kb.index}:\n`;
                            // í…ìŠ¤íŠ¸ë¥¼ 30ìê¹Œì§€ë§Œ í‘œì‹œ (ë„ˆë¬´ ê¸¸ë©´ ì˜ë¼ëƒ„)
                            const displayText = kb.text.length > 50 
                                ? kb.text.substring(0, 50) + '...' 
                                : kb.text;
                            logText += `     "${displayText}"\n`;
                            
                            // í•œê¸€ ë¶€ë¶„ë§Œ í•˜ì´ë¼ì´íŠ¸
                            const koreanParts = kb.text.match(koreanRegex);
                            if (koreanParts && koreanParts.length > 0) {
                                logText += `     í•œê¸€: ${koreanParts.slice(0, 10).join(', ')}${koreanParts.length > 10 ? '...' : ''}\n`;
                            }
                            logText += '\n';
                        });

                        totalKoreanBlocks += koreanBlocks.length;
                    } else {
                        logText += `  âœ… í•œê¸€ ì—†ìŒ - ì •ìƒ\n`;
                    }

                    logText += '\n';
                }

                // ìš”ì•½
                logText += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
                logText += '       ê²€í†  ìš”ì•½\n';
                logText += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
                logText += `  â€¢ ì´ íŒŒì¼ ìˆ˜: ${totalFiles}ê°œ\n`;
                logText += `  â€¢ í•œê¸€ ë°œê²¬ ë¸”ë¡: ${totalKoreanBlocks}ê°œ\n`;
                if (totalKoreanBlocks === 0) {
                    logText += `  â€¢ ìƒíƒœ: âœ… ëª¨ë“  íŒŒì¼ ì •ìƒ\n`;
                } else {
                    logText += `  â€¢ ìƒíƒœ: âš ï¸ ì¬ë²ˆì—­ í•„ìš”\n`;
                }
                logText += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';

                // ê²°ê³¼ í‘œì‹œ
                reviewLogContent = logText;
                reviewResultContent.textContent = logText;
                reviewResultSection.style.display = 'block';

                console.log('ê²€í†  ì™„ë£Œ:', logText);

            } catch (error) {
                console.error('ê²€í†  ì˜¤ë¥˜:', error);
                reviewErrorSection.style.display = 'block';
                reviewErrorText.textContent = `ê²€í†  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`;
            } finally {
                reviewBtn.disabled = false;
                reviewBtn.textContent = 'ğŸ” ê²€í†  ì‹œì‘';
            }
        });

        // ë¡œê·¸ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼
        downloadReviewLogBtn.addEventListener('click', function() {
            if (!reviewLogContent) {
                alert('ê²€í†  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const blob = new Blob([reviewLogContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            a.download = `SRT_ê²€í† ê²°ê³¼_${timestamp}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // ========================================
        // ë‹¨ì–´ ìˆ˜ì • ê¸°ëŠ¥
        // ========================================
        
        const WORD_PAIRS_STORAGE_KEY = 'srt_word_pairs';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë‹¨ì–´ ìŒ ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('DOMContentLoaded', () => {
            loadWordPairs();
        });

        // ë‹¨ì–´ ìŒ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadWordPairs() {
            const saved = localStorage.getItem(WORD_PAIRS_STORAGE_KEY);
            const list = document.getElementById('wordReplacementList');
            list.innerHTML = '';
            
            if (saved) {
                try {
                    const pairs = JSON.parse(saved);
                    if (pairs.length > 0) {
                        pairs.forEach(pair => {
                            addWordPairItem(pair.from, pair.to);
                        });
                        return;
                    }
                } catch (e) {
                    console.error('ë‹¨ì–´ ìŒ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
                }
            }
            // ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ í•­ëª© 1ê°œ ì¶”ê°€
            addWordPairItem('', '');
        }

        // ë‹¨ì–´ ìŒ ì €ì¥
        function saveWordPairs() {
            const items = document.querySelectorAll('#wordReplacementList .word-replacement-item');
            const pairs = [];
            
            items.forEach(item => {
                const from = item.querySelector('.from-word').value.trim();
                const to = item.querySelector('.to-word').value.trim();
                // ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ê°’ì´ ìˆìœ¼ë©´ ì €ì¥
                if (from || to) {
                    pairs.push({ from, to });
                }
            });
            
            localStorage.setItem(WORD_PAIRS_STORAGE_KEY, JSON.stringify(pairs));
        }

        // ë‹¨ì–´ ìŒ í•­ëª© ì¶”ê°€ (ë‚´ë¶€ìš©)
        function addWordPairItem(fromValue = '', toValue = '') {
            const list = document.getElementById('wordReplacementList');
            const newItem = document.createElement('div');
            newItem.className = 'word-replacement-item';
            newItem.innerHTML = `
                <div class="word-input-group">
                    <div class="word-input-wrapper">
                        <label class="word-input-label">ê¸°ì¡´ ë‹¨ì–´</label>
                        <input type="text" class="word-input from-word" placeholder="ì˜ˆ: ìˆ˜ì§€" value="${fromValue}" onchange="saveWordPairs()" oninput="saveWordPairs()">
                    </div>
                    <div class="word-input-wrapper">
                        <label class="word-input-label">ë³€ê²½í•  ë‹¨ì–´</label>
                        <input type="text" class="word-input to-word" placeholder="ì˜ˆ: suji" value="${toValue}" onchange="saveWordPairs()" oninput="saveWordPairs()">
                    </div>
                </div>
                <button type="button" class="btn-remove" onclick="removeWordPair(this)">ğŸ—‘ï¸</button>
            `;
            list.appendChild(newItem);
        }

        // ë‹¨ì–´ ìŒ ì¶”ê°€ í•¨ìˆ˜ (ë²„íŠ¼ í´ë¦­ìš©)
        function addWordPair() {
            addWordPairItem('', '');
            saveWordPairs();
        }

        // ë‹¨ì–´ ìŒ ì œê±° í•¨ìˆ˜
        function removeWordPair(button) {
            const list = document.getElementById('wordReplacementList');
            const items = list.querySelectorAll('.word-replacement-item');
            
            // ìµœì†Œ 1ê°œëŠ” ë‚¨ê²¨ë‘ê¸°
            if (items.length > 1) {
                button.closest('.word-replacement-item').remove();
                saveWordPairs();
            } else {
                alert('ìµœì†Œ 1ê°œì˜ ë‹¨ì–´ ìŒì€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.');
            }
        }

        // ì „ì²´ ì‚­ì œ
        function clearAllWordPairs() {
            if (confirm('ëª¨ë“  ë‹¨ì–´ ìŒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const list = document.getElementById('wordReplacementList');
                list.innerHTML = '';
                addWordPairItem('', ''); // ë¹ˆ í•­ëª© 1ê°œ ì¶”ê°€
                localStorage.removeItem(WORD_PAIRS_STORAGE_KEY);
                alert('ì „ì²´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë‹¤ìš´ë¡œë“œ
        function downloadWordPairs() {
            const items = document.querySelectorAll('#wordReplacementList .word-replacement-item');
            const pairs = [];
            
            items.forEach(item => {
                const from = item.querySelector('.from-word').value.trim();
                const to = item.querySelector('.to-word').value.trim();
                if (from || to) {
                    pairs.push({ from, to });
                }
            });
            
            if (pairs.length === 0) {
                alert('ì €ì¥ëœ ë‹¨ì–´ ìŒì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const blob = new Blob([JSON.stringify(pairs, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'word_pairs.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('ë‹¨ì–´ ìŒ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì—…ë¡œë“œ
        function uploadWordPairs(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const pairs = JSON.parse(content);
                    
                    if (!Array.isArray(pairs)) {
                        throw new Error('ì˜¬ë°”ë¥¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                    }
                    
                    localStorage.setItem(WORD_PAIRS_STORAGE_KEY, JSON.stringify(pairs));
                    loadWordPairs();
                    alert('ë‹¨ì–´ ìŒì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (error) {
                    alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            reader.readAsText(file);
            input.value = '';
        }

        // í†µí•© íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
        const combinedFilesInput = document.getElementById('combined_files');
        const combinedFileNames = document.getElementById('combined-file-names');
        
        combinedFilesInput.addEventListener('change', function() {
            const count = this.files.length;
            if (count > 0) {
                const names = Array.from(this.files).map(f => f.name).join(', ');
                combinedFileNames.textContent = 
                    `${count}ê°œ íŒŒì¼ ì„ íƒë¨: ${names.substring(0, 60)}${names.length > 60 ? '...' : ''}`;
            } else {
                combinedFileNames.textContent = 'ì–¸ì–´ë³„ SRT íŒŒì¼ ì„ íƒ (ì˜ì–´, íƒœêµ­ì–´, ì¤‘êµ­ì–´, ë²ˆì²´, ì¼ë³¸ì–´, ìŠ¤í˜ì¸ì–´, ì¸ë„ë„¤ì‹œì•„ì–´)';
            }
        });

        // í†µí•© íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const combinedFilesWrapper = document.getElementById('combinedFilesWrapper');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            combinedFilesWrapper.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
            });
        });
        
        ['dragenter', 'dragover'].forEach(eventName => {
            combinedFilesWrapper.addEventListener(eventName, () => {
                combinedFilesWrapper.classList.add('drag-over');
            });
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            combinedFilesWrapper.addEventListener(eventName, () => {
                combinedFilesWrapper.classList.remove('drag-over');
            });
        });
        
        combinedFilesWrapper.addEventListener('drop', function(e) {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                combinedFilesInput.files = files;
                const names = Array.from(files).map(f => f.name).join(', ');
                combinedFileNames.textContent = 
                    `${files.length}ê°œ íŒŒì¼ ì„ íƒë¨: ${names.substring(0, 60)}${names.length > 60 ? '...' : ''}`;
            }
        });

        /**
         * í†µí•© ë‹¨ì–´/í™”ìëª… ìˆ˜ì • ì²˜ë¦¬
         */
        async function processCombinedChange() {
            const files = combinedFilesInput.files;
            
            if (files.length === 0) {
                alert('ìˆ˜ì •í•  SRT íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë‹¨ì–´ ìŒ ìˆ˜ì§‘
            const wordPairs = [];
            const wordItems = document.querySelectorAll('#wordReplacementList .word-replacement-item');
            
            for (const item of wordItems) {
                const fromWord = item.querySelector('.from-word').value.trim();
                const toWord = item.querySelector('.to-word').value.trim();
                
                if (fromWord && toWord) {
                    wordPairs.push({ from: fromWord, to: toWord });
                }
            }
            
            // í™”ì ì „ì²´ ì´ë¦„ ë§¤í•‘ ìˆ˜ì§‘
            const speakerMap = {};
            const speakerItems = document.querySelectorAll('#speakerMappingList .speaker-mapping-item');
            
            speakerItems.forEach(item => {
                const kr = item.querySelector('.speaker-kr-input').value.trim();
                if (kr) {
                    speakerMap[kr] = {};
                    item.querySelectorAll('.speaker-lang-input').forEach(input => {
                        const lang = input.getAttribute('data-lang');
                        const value = input.value.trim();
                        if (value) {
                            speakerMap[kr][lang] = value;
                        }
                    });
                }
            });
            
            // í™”ì ë¶€ë¶„ ì´ë¦„ ë§¤í•‘ ìˆ˜ì§‘ (ì„± ì œì™¸)
            const speakerPartialMap = {};
            const speakerPartialItems = document.querySelectorAll('#speakerPartialMappingList .speaker-mapping-item');
            
            speakerPartialItems.forEach(item => {
                const kr = item.querySelector('.speaker-kr-input').value.trim();
                if (kr) {
                    speakerPartialMap[kr] = {};
                    item.querySelectorAll('.speaker-lang-input').forEach(input => {
                        const lang = input.getAttribute('data-lang');
                        const value = input.value.trim();
                        if (value) {
                            speakerPartialMap[kr][lang] = value;
                        }
                    });
                }
            });
            
            // ìµœì†Œ í•˜ë‚˜ëŠ” ìˆì–´ì•¼ í•¨
            if (wordPairs.length === 0 && Object.keys(speakerMap).length === 0 && Object.keys(speakerPartialMap).length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ ë‹¨ì–´ ìŒ ë˜ëŠ” í™”ì ë§¤í•‘ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const btn = document.getElementById('combinedProcessBtn');
            const progressSection = document.getElementById('combinedProgressSection');
            const errorSection = document.getElementById('combinedErrorSection');
            const spinner = document.getElementById('combinedSpinner');
            
            btn.disabled = true;
            progressSection.style.display = 'block';
            errorSection.style.display = 'none';
            spinner.classList.add('active');
            
            try {
                const logLines = [];
                logLines.push('ğŸ” ë‹¨ì–´/í™”ìëª… ìˆ˜ì • ë¡œê·¸');
                logLines.push('='.repeat(50));
                logLines.push('');
                
                // íŒŒì¼ì´ 1ê°œì¸ ê²½ìš°
                if (files.length === 1) {
                    const file = files[0];
                    const rawLang = file.name.replace('.srt', '');
                    const langCode = LANGUAGE_CODES[rawLang] || rawLang;
                    
                    document.getElementById('combinedProgressText').textContent = 
                        `ì²˜ë¦¬ ì¤‘: ${file.name}`;
                    
                    let content = await file.text();
                    let totalWordReplacements = 0;
                    let totalSpeakerReplacements = 0;
                    let totalSpeakerPartialReplacements = 0;
                    
                    // 1. ë‹¨ì–´ ì¹˜í™˜
                    for (const { from, to } of wordPairs) {
                        const regex = new RegExp(from.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                        const matches = content.match(regex);
                        const count = matches ? matches.length : 0;
                        
                        if (count > 0) {
                            content = content.replace(regex, to);
                            totalWordReplacements += count;
                            logLines.push(`  âœï¸ [ë‹¨ì–´] "${from}" â†’ "${to}": ${count}íšŒ ì¹˜í™˜`);
                        }
                    }
                    
                    // 2. í™”ì ì „ì²´ ì´ë¦„ ì¹˜í™˜
                    for (const [krName, langMap] of Object.entries(speakerMap)) {
                        if (langMap[langCode]) {
                            const targetName = langMap[langCode];
                            const regex = new RegExp(krName.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                            const matches = content.match(regex);
                            const count = matches ? matches.length : 0;
                            
                            if (count > 0) {
                                content = content.replace(regex, targetName);
                                totalSpeakerReplacements += count;
                                logLines.push(`  ğŸ­ [ì „ì²´] "${krName}" â†’ "${targetName}": ${count}íšŒ ì¹˜í™˜`);
                            }
                        }
                    }
                    
                    // 3. í™”ì ë¶€ë¶„ ì´ë¦„ ì¹˜í™˜ (ì„± ì œì™¸)
                    for (const [krName, langMap] of Object.entries(speakerPartialMap)) {
                        if (langMap[langCode]) {
                            const targetName = langMap[langCode];
                            const regex = new RegExp(krName.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                            const matches = content.match(regex);
                            const count = matches ? matches.length : 0;
                            
                            if (count > 0) {
                                content = content.replace(regex, targetName);
                                totalSpeakerPartialReplacements += count;
                                logLines.push(`  ğŸ­ [ë¶€ë¶„] "${krName}" â†’ "${targetName}": ${count}íšŒ ì¹˜í™˜`);
                            }
                        }
                    }
                    
                    // ë‹¨ì¼ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = file.name;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    progressSection.style.display = 'none';
                    spinner.classList.remove('active');
                    
                    let message = `âœ… ìˆ˜ì • ì™„ë£Œ!\n\níŒŒì¼: ${file.name}\në‹¨ì–´ ì¹˜í™˜: ${totalWordReplacements}íšŒ\ní™”ì ì „ì²´ ì¹˜í™˜: ${totalSpeakerReplacements}íšŒ\ní™”ì ë¶€ë¶„ ì¹˜í™˜: ${totalSpeakerPartialReplacements}íšŒ`;
                    alert(message);
                    
                } else {
                    // íŒŒì¼ì´ 2ê°œ ì´ìƒì¸ ê²½ìš° ZIPìœ¼ë¡œ
                    const zip = new JSZip();
                    
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        const rawLang = file.name.replace('.srt', '');
                        const langCode = LANGUAGE_CODES[rawLang] || rawLang;
                        
                        document.getElementById('combinedProgressText').textContent = 
                            `ì²˜ë¦¬ ì¤‘: ${file.name}`;
                        document.getElementById('combinedProgressDetails').textContent = 
                            `${i + 1} / ${files.length} íŒŒì¼`;
                        
                        logLines.push(`ğŸ“„ [${rawLang}] ì²˜ë¦¬ ì‹œì‘`);
                        
                        try {
                            let content = await file.text();
                            let totalWordReplacements = 0;
                            let totalSpeakerReplacements = 0;
                            let totalSpeakerPartialReplacements = 0;
                            
                            // 1. ë‹¨ì–´ ì¹˜í™˜
                            for (const { from, to } of wordPairs) {
                                const regex = new RegExp(from.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                                const matches = content.match(regex);
                                const count = matches ? matches.length : 0;
                                
                                if (count > 0) {
                                    content = content.replace(regex, to);
                                    totalWordReplacements += count;
                                    logLines.push(`  âœï¸ [ë‹¨ì–´] "${from}" â†’ "${to}": ${count}íšŒ ì¹˜í™˜`);
                                }
                            }
                            
                            // 2. í™”ì ì „ì²´ ì´ë¦„ ì¹˜í™˜
                            for (const [krName, langMap] of Object.entries(speakerMap)) {
                                if (langMap[langCode]) {
                                    const targetName = langMap[langCode];
                                    const regex = new RegExp(krName.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                                    const matches = content.match(regex);
                                    const count = matches ? matches.length : 0;
                                    
                                    if (count > 0) {
                                        content = content.replace(regex, targetName);
                                        totalSpeakerReplacements += count;
                                        logLines.push(`  ğŸ­ [ì „ì²´] "${krName}" â†’ "${targetName}": ${count}íšŒ ì¹˜í™˜`);
                                    }
                                }
                            }
                            
                            // 3. í™”ì ë¶€ë¶„ ì´ë¦„ ì¹˜í™˜ (ì„± ì œì™¸)
                            for (const [krName, langMap] of Object.entries(speakerPartialMap)) {
                                if (langMap[langCode]) {
                                    const targetName = langMap[langCode];
                                    const regex = new RegExp(krName.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                                    const matches = content.match(regex);
                                    const count = matches ? matches.length : 0;
                                    
                                    if (count > 0) {
                                        content = content.replace(regex, targetName);
                                        totalSpeakerPartialReplacements += count;
                                        logLines.push(`  ğŸ­ [ë¶€ë¶„] "${krName}" â†’ "${targetName}": ${count}íšŒ ì¹˜í™˜`);
                                    }
                                }
                            }
                            
                            zip.file(file.name, content);
                            logLines.push(`âœ… ì €ì¥ ì™„ë£Œ â†’ ${file.name} (ë‹¨ì–´: ${totalWordReplacements}íšŒ, ì „ì²´: ${totalSpeakerReplacements}íšŒ, ë¶€ë¶„: ${totalSpeakerPartialReplacements}íšŒ)`);
                            
                        } catch (error) {
                            logLines.push(`âš ï¸ ${file.name} ì²˜ë¦¬ ì‹¤íŒ¨: ${error.message}`);
                            console.error(`íŒŒì¼ ì²˜ë¦¬ ì‹¤íŒ¨: ${file.name}`, error);
                        }
                        
                        logLines.push('-'.repeat(40));
                        logLines.push('');
                    }
                    
                    // ë¡œê·¸ íŒŒì¼ ì¶”ê°€
                    zip.file('ìˆ˜ì •_ë¡œê·¸.txt', logLines.join('\n'));
                    
                    // ZIP ë‹¤ìš´ë¡œë“œ
                    document.getElementById('combinedProgressText').textContent = 'ZIP íŒŒì¼ ìƒì„± ì¤‘...';
                    const zipBlob = await zip.generateAsync({ 
                        type: 'blob',
                        compression: 'DEFLATE',
                        compressionOptions: { level: 9 }
                    });
                    
                    const url = URL.createObjectURL(zipBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'âœï¸ 2-1. ë‹¨ì–´_í™”ìëª… ìˆ˜ì •.zip';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    progressSection.style.display = 'none';
                    spinner.classList.remove('active');
                    alert(`âœ… ë‹¨ì–´/í™”ìëª… ìˆ˜ì • ì™„ë£Œ!\n\n${files.length}ê°œ íŒŒì¼ì´ ì²˜ë¦¬ë˜ì–´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
                
            } catch (error) {
                console.error('Error:', error);
                progressSection.style.display = 'none';
                spinner.classList.remove('active');
                errorSection.style.display = 'block';
                document.getElementById('combinedErrorText').textContent = error.message;
            } finally {
                btn.disabled = false;
            }
        }

        // ========================================
        // í™”ìëª… ë³€ê²½ ê¸°ëŠ¥
        // ========================================
        
        const SPEAKER_STORAGE_KEY = 'srt_speaker_mappings';
        const LANGUAGE_CODES = {
            'ì˜ì–´': 'en', 'English': 'en', 'en': 'en',
            'ìŠ¤í˜ì¸ì–´': 'es', 'espaÃ±ol': 'es', 'es': 'es',
            'ì¼ë³¸ì–´': 'ja', 'ja': 'ja',
            'ì¤‘êµ­ì–´': 'zh', 'zh': 'zh', 'zh-Hans': 'zh',
            'ë²ˆì²´': 'zh-Hant', 'ç¹é«”ä¸­æ–‡': 'zh-Hant', 'zh-Hant': 'zh-Hant', 'zh-TW': 'zh-Hant',
            'íƒœêµ­ì–´': 'th', 'th': 'th',
            'ì¸ë„ë„¤ì‹œì•„ì–´': 'id', 'id': 'id'
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í™”ì ë§¤í•‘ ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('DOMContentLoaded', () => {
            loadSpeakerMappings();
        });

        // í™”ì ë§¤í•‘ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSpeakerMappings() {
            const saved = localStorage.getItem(SPEAKER_STORAGE_KEY);
            if (saved) {
                try {
                    const mappings = JSON.parse(saved);
                    const list = document.getElementById('speakerMappingList');
                    list.innerHTML = '';
                    mappings.forEach(mapping => {
                        addSpeakerMappingItem(mapping);
                    });
                } catch (e) {
                    console.error('í™”ì ë§¤í•‘ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
                }
            }
        }

        // í™”ì ë§¤í•‘ ì €ì¥
        function saveSpeakerMappings() {
            const items = document.querySelectorAll('#speakerMappingList .speaker-mapping-item');
            const mappings = [];
            
            items.forEach(item => {
                const kr = item.querySelector('.speaker-kr-input').value.trim();
                if (kr) {
                    const mapping = { kr };
                    item.querySelectorAll('.speaker-lang-input').forEach(input => {
                        const lang = input.getAttribute('data-lang');
                        mapping[lang] = input.value.trim();
                    });
                    mappings.push(mapping);
                }
            });
            
            localStorage.setItem(SPEAKER_STORAGE_KEY, JSON.stringify(mappings));
        }

        // í™”ì ë§¤í•‘ í•­ëª© ì¶”ê°€
        function addSpeakerMapping(data = null) {
            addSpeakerMappingItem(data);
            saveSpeakerMappings();
        }

        function addSpeakerMappingItem(data = null) {
            const list = document.getElementById('speakerMappingList');
            const item = document.createElement('div');
            item.className = 'speaker-mapping-item';
            
            const kr = data?.kr || '';
            const en = data?.en || '';
            const es = data?.es || '';
            const ja = data?.ja || '';
            const zh = data?.zh || '';
            const zhHant = data?.['zh-Hant'] || '';
            const th = data?.th || '';
            const id = data?.id || '';
            
            item.innerHTML = `
                <div class="speaker-mapping-header">
                    <input type="text" class="speaker-kr-input" placeholder="í•œêµ­ì–´ ì´ë¦„ (ì˜ˆ: ìˆ˜ì§€)" value="${kr}" onchange="saveSpeakerMappings()">
                    <button type="button" class="btn-remove" onclick="removeSpeakerMapping(this)" style="margin-left: 10px;">ğŸ—‘ï¸</button>
                </div>
                <div class="speaker-lang-grid">
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ì˜ì–´ (English)</label>
                        <input type="text" class="speaker-lang-input" data-lang="en" placeholder="Suji" value="${en}" onchange="saveSpeakerMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ìŠ¤í˜ì¸ì–´ (EspaÃ±ol)</label>
                        <input type="text" class="speaker-lang-input" data-lang="es" placeholder="Suji" value="${es}" onchange="saveSpeakerMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ì¸ë„ë„¤ì‹œì•„ì–´ (ID)</label>
                        <input type="text" class="speaker-lang-input" data-lang="id" placeholder="Suji" value="${id}" onchange="saveSpeakerMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ì¤‘êµ­ì–´ (ç®€ä½“)</label>
                        <input type="text" class="speaker-lang-input" data-lang="zh" placeholder="ç§€æ™º" value="${zh}" onchange="saveSpeakerMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ë²ˆì²´ (ç¹é«”)</label>
                        <input type="text" class="speaker-lang-input" data-lang="zh-Hant" placeholder="ç§€æ™º" value="${zhHant}" onchange="saveSpeakerMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">íƒœêµ­ì–´ (à¹„à¸—à¸¢)</label>
                        <input type="text" class="speaker-lang-input" data-lang="th" placeholder="à¸‹à¸¹à¸ˆà¸µ" value="${th}" onchange="saveSpeakerMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ì¼ë³¸ì–´ (æ—¥æœ¬èª)</label>
                        <input type="text" class="speaker-lang-input" data-lang="ja" placeholder="ã‚¹ã‚¸" value="${ja}" onchange="saveSpeakerMappings()">
                    </div>
                </div>
            `;
            
            list.appendChild(item);
        }

        // í™”ì ë§¤í•‘ ì œê±°
        function removeSpeakerMapping(button) {
            button.closest('.speaker-mapping-item').remove();
            saveSpeakerMappings();
        }

        // ì „ì²´ ì‚­ì œ
        function clearAllSpeakers() {
            if (confirm('ëª¨ë“  í™”ì ë§¤í•‘ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('speakerMappingList').innerHTML = '';
                localStorage.removeItem(SPEAKER_STORAGE_KEY);
                alert('ì „ì²´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë‹¤ìš´ë¡œë“œ
        function downloadSpeakerMapping() {
            const saved = localStorage.getItem(SPEAKER_STORAGE_KEY);
            if (!saved) {
                alert('ì €ì¥ëœ í™”ì ë§¤í•‘ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const blob = new Blob([saved], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'speaker_mappings.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('í™”ì ë§¤í•‘ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì—…ë¡œë“œ
        function uploadSpeakerMapping(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const mappings = JSON.parse(content);
                    
                    if (!Array.isArray(mappings)) {
                        throw new Error('ì˜¬ë°”ë¥¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                    }
                    
                    localStorage.setItem(SPEAKER_STORAGE_KEY, content);
                    loadSpeakerMappings();
                    alert('í™”ì ë§¤í•‘ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (error) {
                    alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            reader.readAsText(file);
            input.value = '';
        }

        // ========================================
        // í™”ìëª… ë¶€ë¶„ ë³€ê²½ ê¸°ëŠ¥ (2-2)
        // ========================================
        
        const SPEAKER_PARTIAL_STORAGE_KEY = 'srt_speaker_partial_mappings';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í™”ì ë¶€ë¶„ ë§¤í•‘ ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('DOMContentLoaded', () => {
            loadSpeakerPartialMappings();
        });

        // í™”ì ë¶€ë¶„ ë§¤í•‘ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSpeakerPartialMappings() {
            const saved = localStorage.getItem(SPEAKER_PARTIAL_STORAGE_KEY);
            if (saved) {
                try {
                    const mappings = JSON.parse(saved);
                    const list = document.getElementById('speakerPartialMappingList');
                    list.innerHTML = '';
                    mappings.forEach(mapping => {
                        addSpeakerPartialMappingItem(mapping);
                    });
                } catch (e) {
                    console.error('í™”ì ë¶€ë¶„ ë§¤í•‘ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
                }
            }
        }

        // í™”ì ë¶€ë¶„ ë§¤í•‘ ì €ì¥
        function saveSpeakerPartialMappings() {
            const items = document.querySelectorAll('#speakerPartialMappingList .speaker-mapping-item');
            const mappings = [];
            
            items.forEach(item => {
                const kr = item.querySelector('.speaker-kr-input').value.trim();
                if (kr) {
                    const mapping = { kr };
                    item.querySelectorAll('.speaker-lang-input').forEach(input => {
                        const lang = input.getAttribute('data-lang');
                        mapping[lang] = input.value.trim();
                    });
                    mappings.push(mapping);
                }
            });
            
            localStorage.setItem(SPEAKER_PARTIAL_STORAGE_KEY, JSON.stringify(mappings));
        }

        // í™”ì ë¶€ë¶„ ë§¤í•‘ í•­ëª© ì¶”ê°€
        function addSpeakerPartialMapping(data = null) {
            addSpeakerPartialMappingItem(data);
            saveSpeakerPartialMappings();
        }

        function addSpeakerPartialMappingItem(data = null) {
            const list = document.getElementById('speakerPartialMappingList');
            const item = document.createElement('div');
            item.className = 'speaker-mapping-item';
            
            const kr = data?.kr || '';
            const en = data?.en || '';
            const es = data?.es || '';
            const ja = data?.ja || '';
            const zh = data?.zh || '';
            const zhHant = data?.['zh-Hant'] || '';
            const th = data?.th || '';
            const id = data?.id || '';
            
            item.innerHTML = `
                <div class="speaker-mapping-header">
                    <input type="text" class="speaker-kr-input" placeholder="í•œêµ­ì–´ ì´ë¦„ (ì˜ˆ: ìˆ˜ì§€)" value="${kr}" onchange="saveSpeakerPartialMappings()">
                    <button type="button" class="btn-remove" onclick="removeSpeakerPartialMapping(this)" style="margin-left: 10px;">ğŸ—‘ï¸</button>
                </div>
                <div class="speaker-lang-grid">
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ì˜ì–´ (English)</label>
                        <input type="text" class="speaker-lang-input" data-lang="en" placeholder="Suji" value="${en}" onchange="saveSpeakerPartialMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ìŠ¤í˜ì¸ì–´ (EspaÃ±ol)</label>
                        <input type="text" class="speaker-lang-input" data-lang="es" placeholder="Suji" value="${es}" onchange="saveSpeakerPartialMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ì¸ë„ë„¤ì‹œì•„ì–´ (ID)</label>
                        <input type="text" class="speaker-lang-input" data-lang="id" placeholder="Suji" value="${id}" onchange="saveSpeakerPartialMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ì¤‘êµ­ì–´ (ç®€ä½“)</label>
                        <input type="text" class="speaker-lang-input" data-lang="zh" placeholder="ç§€æ™º" value="${zh}" onchange="saveSpeakerPartialMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ë²ˆì²´ (ç¹é«”)</label>
                        <input type="text" class="speaker-lang-input" data-lang="zh-Hant" placeholder="ç§€æ™º" value="${zhHant}" onchange="saveSpeakerPartialMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">íƒœêµ­ì–´ (à¹„à¸—à¸¢)</label>
                        <input type="text" class="speaker-lang-input" data-lang="th" placeholder="à¸‹à¸¹à¸ˆà¸µ" value="${th}" onchange="saveSpeakerPartialMappings()">
                    </div>
                    <div class="speaker-lang-item">
                        <label class="speaker-lang-label">ì¼ë³¸ì–´ (æ—¥æœ¬èª)</label>
                        <input type="text" class="speaker-lang-input" data-lang="ja" placeholder="ã‚¹ã‚¸" value="${ja}" onchange="saveSpeakerPartialMappings()">
                    </div>
                </div>
            `;
            
            list.appendChild(item);
        }

        // í™”ì ë¶€ë¶„ ë§¤í•‘ ì œê±°
        function removeSpeakerPartialMapping(button) {
            button.closest('.speaker-mapping-item').remove();
            saveSpeakerPartialMappings();
        }

        // ì „ì²´ ì‚­ì œ
        function clearAllSpeakersPartial() {
            if (confirm('ëª¨ë“  í™”ì ë§¤í•‘ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('speakerPartialMappingList').innerHTML = '';
                localStorage.removeItem(SPEAKER_PARTIAL_STORAGE_KEY);
                alert('ì „ì²´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë‹¤ìš´ë¡œë“œ
        function downloadSpeakerPartialMapping() {
            const saved = localStorage.getItem(SPEAKER_PARTIAL_STORAGE_KEY);
            if (!saved) {
                alert('ì €ì¥ëœ í™”ì ë§¤í•‘ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const blob = new Blob([saved], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'speaker_partial_mappings.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('í™”ì ë§¤í•‘ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì—…ë¡œë“œ
        function uploadSpeakerPartialMapping(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const mappings = JSON.parse(content);
                    
                    if (!Array.isArray(mappings)) {
                        throw new Error('ì˜¬ë°”ë¥¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                    }
                    
                    localStorage.setItem(SPEAKER_PARTIAL_STORAGE_KEY, content);
                    loadSpeakerPartialMappings();
                    alert('í™”ì ë§¤í•‘ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (error) {
                    alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            reader.readAsText(file);
            input.value = '';
        }

        // ========================================
        // í”„ë¦¬ë¯¸ì–´ ìë§‰ ë³€í™˜ ê¸°ëŠ¥
        // ========================================
        
        // í”„ë¦¬ë¯¸ì–´ íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
        const premiereFileInput = document.getElementById('premiere_files');
        const premiereFileNames = document.getElementById('premiere-file-names');
        
        premiereFileInput.addEventListener('change', function(e) {
            const files = e.target.files;
            if (files.length > 0) {
                const fileNames = Array.from(files).map(f => f.name).join(', ');
                premiereFileNames.textContent = 
                    `${files.length}ê°œ íŒŒì¼ ì„ íƒë¨: ${fileNames.substring(0, 50)}${fileNames.length > 50 ? '...' : ''}`;
            } else {
                premiereFileNames.textContent = 'íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš” (ì—¬ëŸ¬ íŒŒì¼ ì„ íƒ ê°€ëŠ¥)';
            }
        });

        // í”„ë¦¬ë¯¸ì–´ íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const premiereFileUploadWrapper = document.getElementById('premiereFileUploadWrapper');
        
        if (premiereFileUploadWrapper) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                premiereFileUploadWrapper.addEventListener(eventName, e => {
                    e.preventDefault();
                    e.stopPropagation();
                });
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                premiereFileUploadWrapper.addEventListener(eventName, () => {
                    premiereFileUploadWrapper.classList.add('drag-over');
                });
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                premiereFileUploadWrapper.addEventListener(eventName, () => {
                    premiereFileUploadWrapper.classList.remove('drag-over');
                });
            });
            
            premiereFileUploadWrapper.addEventListener('drop', function(e) {
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    premiereFileInput.files = files;
                    const fileNames = Array.from(files).map(f => f.name).join(', ');
                    premiereFileNames.textContent = 
                        `${files.length}ê°œ íŒŒì¼ ì„ íƒë¨: ${fileNames.substring(0, 50)}${fileNames.length > 50 ? '...' : ''}`;
                }
            });
        }

        // íƒ€ì„ì½”ë“œ íŒ¨í„´ ì •ê·œì‹
        const timecodePattern = /^\d{2};\d{2};\d{2};\d{2} - \d{2};\d{2};\d{2};\d{2}$/;
        const vPattern = /^V\d+,\s*\d+$/;

        /**
         * ì„¸ë¯¸ì½œë¡  ê¸°ë°˜ íƒ€ì„ì½”ë“œë¥¼ ì½œë¡ /ì½¤ë§ˆ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
         * 00;00;04;18 â†’ 00:00:04,18
         */
        function convertTimecode(tc) {
            tc = tc.trim();
            const parts = tc.split(';');
            if (parts.length !== 4) {
                throw new Error(`íƒ€ì„ì½”ë“œ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤: ${tc}`);
            }
            return `${parts[0]}:${parts[1]}:${parts[2]},${parts[3]}`;
        }

        /**
         * íƒ€ì„ì½”ë“œ êµ¬ê°„ ë³€í™˜
         * 00:00:14,18  -  00:00:18,27 â†’ 00:00:14,18 --> 00:00:18,27
         */
        function formatTimeRange(content) {
            const rangePattern = /(\d{2}:\d{2}:\d{2},\d{2})\s*-\s*(\d{2}:\d{2}:\d{2},\d{2})/g;
            return content.replace(rangePattern, (match, start, end) => {
                return `${start} --> ${end}`;
            });
        }

        /**
         * í”„ë¦¬ë¯¸ì–´ ìë§‰ íŒŒì¼ì„ í‘œì¤€ SRT í˜•ì‹ìœ¼ë¡œ ë³€í™˜
         * 1ë‹¨ê³„: ë¸”ë¡ ë²ˆí˜¸ ì¶”ê°€ ë° V íŒ¨í„´ ì œê±°
         * 2ë‹¨ê³„: íƒ€ì„ì½”ë“œ í˜•ì‹ ë³€í™˜
         */
        function convertPremiereToSRT(fileContent) {
            const lines = fileContent.split(/\r?\n/).map(line => line.trim()).filter(line => line);
            
            const blocks = [];
            let i = 0;
            let blockNum = 1;

            // 1ë‹¨ê³„: ë¸”ë¡ êµ¬ì¡° íŒŒì‹±
            while (i < lines.length) {
                if (timecodePattern.test(lines[i])) {
                    let timecode = lines[i];
                    i++;

                    // V íŒ¨í„´ ê±´ë„ˆë›°ê¸°
                    if (i < lines.length && vPattern.test(lines[i])) {
                        i++;
                    }

                    // ëŒ€ì‚¬ ìˆ˜ì§‘
                    const dialogueLines = [];
                    while (i < lines.length && !timecodePattern.test(lines[i])) {
                        if (!vPattern.test(lines[i])) {
                            dialogueLines.push(lines[i]);
                        }
                        i++;
                    }

                    if (dialogueLines.length > 0) {
                        blocks.push({
                            index: blockNum,
                            timecode: timecode,
                            text: dialogueLines.join('\n')
                        });
                        blockNum++;
                    }
                } else {
                    i++;
                }
            }

            // 2ë‹¨ê³„: íƒ€ì„ì½”ë“œ í˜•ì‹ ë³€í™˜
            let srtContent = '';
            for (const block of blocks) {
                // ì„¸ë¯¸ì½œë¡  ê¸°ë°˜ íƒ€ì„ì½”ë“œ ë³€í™˜
                let convertedTimecode = block.timecode.replace(/\d{2};\d{2};\d{2};\d{2}/g, (match) => {
                    return convertTimecode(match);
                });

                // " - " â†’ " --> " ë³€í™˜
                convertedTimecode = formatTimeRange(convertedTimecode);

                srtContent += `${block.index}\n${convertedTimecode}\n${block.text}\n\n`;
            }

            return srtContent;
        }

        /**
         * í”„ë¦¬ë¯¸ì–´ ë³€í™˜ í¼ ì œì¶œ
         */
        document.getElementById('premiereForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const files = premiereFileInput.files;
            if (files.length === 0) {
                alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const convertBtn = document.getElementById('convertBtn');
            const progressSection = document.getElementById('premiereProgressSection');
            const errorSection = document.getElementById('premiereErrorSection');
            const spinner = document.getElementById('premiereSpinner');

            convertBtn.disabled = true;
            progressSection.style.display = 'block';
            errorSection.style.display = 'none';
            spinner.classList.add('active');

            try {
                const totalFiles = files.length;

                // íŒŒì¼ì´ 1ê°œì¸ ê²½ìš°
                if (totalFiles === 1) {
                    const file = files[0];
                    
                    document.getElementById('premiereProgressText').textContent = 
                        `ë³€í™˜ ì¤‘: ${file.name}`;
                    document.getElementById('premiereProgressBar').style.width = '100%';
                    document.getElementById('premiereProgressPercent').textContent = '100%';

                    const fileContent = await file.text();
                    const convertedContent = convertPremiereToSRT(fileContent);
                    
                    const originalName = file.name.replace('.srt', '');
                    const newFileName = `${originalName}_converted.srt`;
                    
                    // ë‹¨ì¼ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                    const blob = new Blob([convertedContent], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = newFileName;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    progressSection.style.display = 'none';
                    spinner.classList.remove('active');
                    alert(`âœ… ë³€í™˜ ì™„ë£Œ!\n\níŒŒì¼: ${newFileName}`);
                    
                } else {
                    // íŒŒì¼ì´ 2ê°œ ì´ìƒì¸ ê²½ìš° ZIPìœ¼ë¡œ
                    const zip = new JSZip();

                    for (let i = 0; i < totalFiles; i++) {
                        const file = files[i];
                        const percent = Math.round(((i + 1) / totalFiles) * 100);

                        document.getElementById('premiereProgressText').textContent = 
                            `ë³€í™˜ ì¤‘: ${file.name}`;
                        document.getElementById('premiereProgressDetails').textContent = 
                            `${i + 1} / ${totalFiles} íŒŒì¼`;
                        document.getElementById('premiereProgressBar').style.width = `${percent}%`;
                        document.getElementById('premiereProgressPercent').textContent = `${percent}%`;

                        try {
                            const fileContent = await file.text();
                            const convertedContent = convertPremiereToSRT(fileContent);
                            
                            const originalName = file.name.replace('.srt', '');
                            const newFileName = `${originalName}_converted.srt`;
                            
                            zip.file(newFileName, convertedContent);
                        } catch (error) {
                            console.error(`íŒŒì¼ ë³€í™˜ ì‹¤íŒ¨: ${file.name}`, error);
                            throw new Error(`${file.name} ë³€í™˜ ì‹¤íŒ¨: ${error.message}`);
                        }
                    }

                    // ZIP íŒŒì¼ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
                    document.getElementById('premiereProgressText').textContent = 'ZIP íŒŒì¼ ìƒì„± ì¤‘...';
                    const zipBlob = await zip.generateAsync({ 
                        type: 'blob',
                        compression: 'DEFLATE',
                        compressionOptions: { level: 9 }
                    });

                    const url = URL.createObjectURL(zipBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'converted_subtitles.zip';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    progressSection.style.display = 'none';
                    spinner.classList.remove('active');
                    alert(`âœ… ë³€í™˜ ì™„ë£Œ!\n\n${totalFiles}ê°œ íŒŒì¼ì´ ë³€í™˜ë˜ì–´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }

            } catch (error) {
                console.error('Error:', error);
                progressSection.style.display = 'none';
                spinner.classList.remove('active');
                errorSection.style.display = 'block';
                document.getElementById('premiereErrorText').textContent = error.message;
            } finally {
                convertBtn.disabled = false;
            }
        });
    </script>
</body>
</html>


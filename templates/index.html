<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRT íŒŒì¼ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <header class="header">
            <h1>ğŸ“ SRT íŒŒì¼ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸</h1>
            <p class="subtitle">TXT ë³€í™˜ â†’ íŒŒì¼ ë³µì œ â†’ ë‹¨ì–´ ìˆ˜ì • â†’ í™”ìëª… ë³€ê²½</p>
        </header>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- 1-1: TXT â†’ SRT ë³€í™˜ ì„¹ì…˜ -->
            <section class="pipeline-section" id="section-1-1">
                <div class="section-header">
                    <h2>1-1. TXT â†’ SRT ë³€í™˜</h2>
                    <span class="section-status" id="status-1-1">ëŒ€ê¸° ì¤‘</span>
                </div>
                
                <div class="section-content">
                    <div class="form-section">
                        <label for="txt_file" class="form-label">
                            <span class="label-text">ğŸ“„ TXT íŒŒì¼ ì—…ë¡œë“œ</span>
                        </label>
                        <div class="file-upload-wrapper">
                            <input 
                                type="file" 
                                id="txt_file" 
                                accept=".txt" 
                                class="file-input"
                            >
                            <label for="txt_file" class="file-upload-label">
                                <span class="file-icon">ğŸ“</span>
                                <span id="txt-file-name">TXT íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</span>
                            </label>
                        </div>
                    </div>

                    <button type="button" id="btn-convert" class="btn-primary">
                        ğŸš€ SRT ë³€í™˜ ì‹¤í–‰
                    </button>

                    <div class="result-preview" id="result-1-1" style="display: none;">
                        <h3>ë³€í™˜ ê²°ê³¼:</h3>
                        <div class="save-info">
                            <span class="save-icon">ğŸ“</span>
                            <span>ì €ì¥ ìœ„ì¹˜: <strong id="saved-path-1-1"></strong></span>
                        </div>
                        <pre id="preview-1-1"></pre>
                        <button type="button" class="btn-download" onclick="downloadFile('1-1')">
                            ğŸ’¾ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                </div>
            </section>

            <!-- 1-2: SRT íŒŒì¼ ë³µì œ ì„¹ì…˜ -->
            <section class="pipeline-section" id="section-1-2">
                <div class="section-header">
                    <h2>1-2. SRT íŒŒì¼ ë³µì œ (ë‹¤êµ­ì–´ íŒŒì¼ ìƒì„±)</h2>
                    <span class="section-status" id="status-1-2">ëŒ€ê¸° ì¤‘</span>
                </div>
                
                <div class="section-content">
                    <div class="form-section">
                        <label for="srt_file_1_2" class="form-label">
                            <span class="label-text">ğŸ“„ SRT íŒŒì¼ ì—…ë¡œë“œ</span>
                        </label>
                        <div class="file-upload-wrapper">
                            <input 
                                type="file" 
                                id="srt_file_1_2" 
                                accept=".srt" 
                                class="file-input"
                            >
                            <label for="srt_file_1_2" class="file-upload-label">
                                <span class="file-icon">ğŸ“</span>
                                <span id="srt-file-name-1-2">SRT íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-section">
                        <label for="duplicate_count" class="form-label">
                            <span class="label-text">ë³µì œ ê°œìˆ˜</span>
                        </label>
                        <input 
                            type="number" 
                            id="duplicate_count" 
                            class="form-input" 
                            value="1" 
                            min="1" 
                            max="10"
                        >
                    </div>

                    <button type="button" id="btn-duplicate" class="btn-primary">
                        ğŸ“‘ íŒŒì¼ ë³µì œ ì‹¤í–‰
                    </button>

                    <div class="result-preview" id="result-1-2" style="display: none;">
                        <h3>ë³µì œëœ íŒŒì¼ ëª©ë¡:</h3>
                        <div class="save-info">
                            <span class="save-icon">ğŸ“</span>
                            <span>ì €ì¥ ìœ„ì¹˜: <strong id="saved-path-1-2"></strong></span>
                        </div>
                        <div id="duplicated-files-list"></div>
                    </div>
                </div>
            </section>

            <!-- 2-1: ë‹¨ì–´ ìˆ˜ì • ì„¹ì…˜ -->
            <section class="pipeline-section" id="section-2-1">
                <div class="section-header">
                    <h2>2-1. ë‹¨ì–´ ìˆ˜ì •</h2>
                    <span class="section-status" id="status-2-1">ëŒ€ê¸° ì¤‘</span>
                </div>
                
                <div class="section-content">
                    <div class="form-section">
                        <label for="srt_file_2_1" class="form-label">
                            <span class="label-text">ğŸ“„ SRT íŒŒì¼ ì—…ë¡œë“œ</span>
                        </label>
                        <div class="file-upload-wrapper">
                            <input 
                                type="file" 
                                id="srt_file_2_1" 
                                accept=".srt" 
                                class="file-input"
                            >
                            <label for="srt_file_2_1" class="file-upload-label">
                                <span class="file-icon">ğŸ“</span>
                                <span id="srt-file-name-2-1">SRT íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-section">
                        <label class="form-label">
                            <span class="label-text">ë‹¨ì–´ êµì²´ ê·œì¹™</span>
                        </label>
                        <div id="replacement-rules-2-1">
                            <div class="replacement-row">
                                <input type="text" class="form-input-small" placeholder="ì°¾ì„ ë‹¨ì–´" data-type="old">
                                <span class="arrow">â†’</span>
                                <input type="text" class="form-input-small" placeholder="ë°”ê¿€ ë‹¨ì–´" data-type="new">
                                <button type="button" class="btn-remove" onclick="removeRule(this)">Ã—</button>
                            </div>
                        </div>
                        <button type="button" id="btn-add-rule-2-1" class="btn-link">+ ê·œì¹™ ì¶”ê°€</button>
                    </div>

                    <button type="button" id="btn-replace" class="btn-primary">
                        âœï¸ ë‹¨ì–´ ìˆ˜ì • ì‹¤í–‰
                    </button>

                    <div class="result-preview" id="result-2-1" style="display: none;">
                        <h3>ìˆ˜ì • ê²°ê³¼:</h3>
                        <div class="save-info">
                            <span class="save-icon">ğŸ“</span>
                            <span>ì €ì¥ ìœ„ì¹˜: <strong id="saved-path-2-1"></strong></span>
                        </div>
                        <div id="replacement-summary-2-1"></div>
                        <pre id="preview-2-1"></pre>
                        <button type="button" class="btn-download" onclick="downloadFile('2-1')">
                            ğŸ’¾ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                </div>
            </section>

            <!-- 2-2: í™”ìëª… ì „ì²´ ë³€ê²½ ì„¹ì…˜ -->
            <section class="pipeline-section" id="section-2-2">
                <div class="section-header">
                    <h2>2-2. í™”ìëª… ì „ì²´ ë³€ê²½ (íŒŒì¼ ì „ì²´ì—ì„œ ì´ë¦„ ì¹˜í™˜)</h2>
                    <span class="section-status" id="status-2-2">ëŒ€ê¸° ì¤‘</span>
                </div>
                
                <div class="section-content">
                    <div class="form-section">
                        <label for="srt_file_2_2" class="form-label">
                            <span class="label-text">ğŸ“„ SRT íŒŒì¼ ì—…ë¡œë“œ</span>
                        </label>
                        <div class="file-upload-wrapper">
                            <input 
                                type="file" 
                                id="srt_file_2_2" 
                                accept=".srt" 
                                class="file-input"
                            >
                            <label for="srt_file_2_2" class="file-upload-label">
                                <span class="file-icon">ğŸ“</span>
                                <span id="srt-file-name-2-2">SRT íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-section">
                        <label class="form-label">
                            <span class="label-text">í™”ìëª… êµì²´ ê·œì¹™</span>
                        </label>
                        <div id="replacement-rules-2-2">
                            <div class="replacement-row">
                                <input type="text" class="form-input-small" placeholder="ì›ë˜ í™”ìëª…" data-type="old">
                                <span class="arrow">â†’</span>
                                <input type="text" class="form-input-small" placeholder="ìƒˆ í™”ìëª…" data-type="new">
                                <button type="button" class="btn-remove" onclick="removeRule(this)">Ã—</button>
                            </div>
                        </div>
                        <button type="button" id="btn-add-rule-2-2" class="btn-link">+ ê·œì¹™ ì¶”ê°€</button>
                    </div>

                    <button type="button" id="btn-replace-speaker" class="btn-primary">
                        ğŸ‘¤ í™”ìëª… ë³€ê²½ ì‹¤í–‰
                    </button>

                    <div class="result-preview" id="result-2-2" style="display: none;">
                        <h3>ë³€ê²½ ê²°ê³¼:</h3>
                        <div class="save-info">
                            <span class="save-icon">ğŸ“</span>
                            <span>ì €ì¥ ìœ„ì¹˜: <strong id="saved-path-2-2"></strong></span>
                        </div>
                        <div id="replacement-summary-2-2"></div>
                        <pre id="preview-2-2"></pre>
                        <button type="button" class="btn-download" onclick="downloadFile('2-2')">
                            ğŸ’¾ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                </div>
            </section>

            <!-- ì§„í–‰ ìƒíƒœ í‘œì‹œ -->
            <div id="progressSection" class="progress-section" style="display: none;">
                <div class="progress-info">
                    <div class="spinner"></div>
                    <p id="progressText">ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p>
                </div>
            </div>

            <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
            <div id="errorSection" class="error-section" style="display: none;">
                <div class="error-content">
                    <span class="error-icon">âš ï¸</span>
                    <p id="errorText"></p>
                </div>
            </div>
        </main>

        <!-- í‘¸í„° -->
        <footer class="footer">
            <p>Made with â¤ï¸ by SRT Pipeline</p>
        </footer>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜: ê° ë‹¨ê³„ì˜ ê²°ê³¼ ë°ì´í„°
        let stepData = {
            '1-1': { content: '', filename: '' },
            '1-2': { content: '', filename: '' },
            '2-1': { content: '', filename: '' },
            '2-2': { content: '', filename: '' }
        };

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ - 1-1 TXT
        document.getElementById('txt_file').addEventListener('change', function(e) {
            const fileNameDisplay = document.getElementById('txt-file-name');
            if (this.files && this.files.length > 0) {
                fileNameDisplay.textContent = this.files[0].name;
            } else {
                fileNameDisplay.textContent = 'TXT íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”';
            }
        });

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ - 1-2 SRT
        document.getElementById('srt_file_1_2').addEventListener('change', function(e) {
            const fileNameDisplay = document.getElementById('srt-file-name-1-2');
            if (this.files && this.files.length > 0) {
                fileNameDisplay.textContent = this.files[0].name;
            } else {
                fileNameDisplay.textContent = 'SRT íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”';
            }
        });

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ - 2-1 SRT
        document.getElementById('srt_file_2_1').addEventListener('change', function(e) {
            const fileNameDisplay = document.getElementById('srt-file-name-2-1');
            if (this.files && this.files.length > 0) {
                fileNameDisplay.textContent = this.files[0].name;
            } else {
                fileNameDisplay.textContent = 'SRT íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”';
            }
        });

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ - 2-2 SRT
        document.getElementById('srt_file_2_2').addEventListener('change', function(e) {
            const fileNameDisplay = document.getElementById('srt-file-name-2-2');
            if (this.files && this.files.length > 0) {
                fileNameDisplay.textContent = this.files[0].name;
            } else {
                fileNameDisplay.textContent = 'SRT íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”';
            }
        });

        // 1-1: TXT â†’ SRT ë³€í™˜ ì‹¤í–‰
        document.getElementById('btn-convert').addEventListener('click', async function() {
            const fileInput = document.getElementById('txt_file');
            const file = fileInput.files[0];

            if (!file) {
                showError('TXT íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            showProgress('TXTë¥¼ SRTë¡œ ë³€í™˜ ì¤‘...');
            updateStatus('1-1', 'processing');

            const formData = new FormData();
            formData.append('txt_file', file);

            try {
                const response = await fetch('/convert_txt_to_srt', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }

                // ê²°ê³¼ ì €ì¥
                stepData['1-1'] = {
                    content: result.content,
                    filename: result.filename
                };

                // ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                document.getElementById('preview-1-1').textContent = result.content.substring(0, 500) + '...';
                document.getElementById('saved-path-1-1').textContent = result.saved_to;
                document.getElementById('result-1-1').style.display = 'block';

                updateStatus('1-1', 'completed');
                hideProgress();

                alert(`âœ… ë³€í™˜ ì™„ë£Œ!\nì €ì¥ ìœ„ì¹˜: ${result.saved_to}`);

            } catch (error) {
                showError(error.message);
                updateStatus('1-1', 'error');
            }
        });

        // 1-2: SRT íŒŒì¼ ë³µì œ ì‹¤í–‰
        document.getElementById('btn-duplicate').addEventListener('click', async function() {
            const fileInput = document.getElementById('srt_file_1_2');
            const file = fileInput.files[0];
            const count = parseInt(document.getElementById('duplicate_count').value);

            if (!file) {
                showError('SRT íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            showProgress(`íŒŒì¼ì„ ${count}ê°œ ë³µì œ ì¤‘...`);
            updateStatus('1-2', 'processing');

            try {
                // íŒŒì¼ ì½ê¸°
                const content = await file.text();

                const response = await fetch('/duplicate_srt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content: content,
                        filename: file.name,
                        count: count
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'ë³µì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }

                // ë³µì œëœ íŒŒì¼ ëª©ë¡ í‘œì‹œ
                const filesList = document.getElementById('duplicated-files-list');
                filesList.innerHTML = '';
                
                result.files.forEach((file, index) => {
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'file-item';
                    fileDiv.innerHTML = `
                        <span>ğŸ“„ ${file.filename}</span>
                    `;
                    filesList.appendChild(fileDiv);
                });

                document.getElementById('saved-path-1-2').textContent = result.saved_to;
                document.getElementById('result-1-2').style.display = 'block';

                updateStatus('1-2', 'completed');
                hideProgress();

                alert(`âœ… ë³µì œ ì™„ë£Œ!\nì €ì¥ ìœ„ì¹˜: ${result.saved_to}`);

            } catch (error) {
                showError(error.message);
                updateStatus('1-2', 'error');
            }
        });

        // 2-1: ë‹¨ì–´ ìˆ˜ì • ì‹¤í–‰
        document.getElementById('btn-replace').addEventListener('click', async function() {
            const fileInput = document.getElementById('srt_file_2_1');
            const file = fileInput.files[0];

            if (!file) {
                showError('SRT íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // êµì²´ ê·œì¹™ ìˆ˜ì§‘
            const replacements = [];
            const rows = document.querySelectorAll('#replacement-rules-2-1 .replacement-row');
            
            rows.forEach(row => {
                const oldWord = row.querySelector('[data-type="old"]').value.trim();
                const newWord = row.querySelector('[data-type="new"]').value.trim();
                
                if (oldWord) {
                    replacements.push({ old: oldWord, new: newWord });
                }
            });

            if (replacements.length === 0) {
                showError('ìµœì†Œ í•˜ë‚˜ì˜ êµì²´ ê·œì¹™ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            showProgress('ë‹¨ì–´ë¥¼ ìˆ˜ì • ì¤‘...');
            updateStatus('2-1', 'processing');

            try {
                // íŒŒì¼ ì½ê¸°
                const content = await file.text();

                const response = await fetch('/replace_words', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content: content,
                        filename: file.name,
                        replacements: replacements
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }

                // ê²°ê³¼ ì €ì¥
                stepData['2-1'] = {
                    content: result.content,
                    filename: result.filename
                };

                // êµì²´ ìš”ì•½ í‘œì‹œ
                const summary = document.getElementById('replacement-summary-2-1');
                summary.innerHTML = '<h4>êµì²´ëœ ë‹¨ì–´:</h4>';
                
                for (const [word, count] of Object.entries(result.replacement_count)) {
                    summary.innerHTML += `<p>â€¢ "${word}" â†’ ${count}ë²ˆ êµì²´ë¨</p>`;
                }

                // ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                document.getElementById('preview-2-1').textContent = result.content.substring(0, 500) + '...';
                document.getElementById('saved-path-2-1').textContent = result.saved_to;
                document.getElementById('result-2-1').style.display = 'block';

                updateStatus('2-1', 'completed');
                hideProgress();

                alert(`âœ… ìˆ˜ì • ì™„ë£Œ!\nì €ì¥ ìœ„ì¹˜: ${result.saved_to}`);

            } catch (error) {
                showError(error.message);
                updateStatus('2-1', 'error');
            }
        });

        // 2-2: í™”ìëª… ì „ì²´ ë³€ê²½ ì‹¤í–‰
        document.getElementById('btn-replace-speaker').addEventListener('click', async function() {
            const fileInput = document.getElementById('srt_file_2_2');
            const file = fileInput.files[0];

            if (!file) {
                showError('SRT íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // êµì²´ ê·œì¹™ ìˆ˜ì§‘
            const replacements = [];
            const rows = document.querySelectorAll('#replacement-rules-2-2 .replacement-row');
            
            rows.forEach(row => {
                const oldName = row.querySelector('[data-type="old"]').value.trim();
                const newName = row.querySelector('[data-type="new"]').value.trim();
                
                if (oldName) {
                    replacements.push({ old: oldName, new: newName });
                }
            });

            if (replacements.length === 0) {
                showError('ìµœì†Œ í•˜ë‚˜ì˜ í™”ìëª… êµì²´ ê·œì¹™ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            showProgress('í™”ìëª…ì„ ë³€ê²½ ì¤‘...');
            updateStatus('2-2', 'processing');

            try {
                // íŒŒì¼ ì½ê¸°
                const content = await file.text();

                const response = await fetch('/replace_speaker_names', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content: content,
                        filename: file.name,
                        replacements: replacements
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }

                // ê²°ê³¼ ì €ì¥
                stepData['2-2'] = {
                    content: result.content,
                    filename: result.filename
                };

                // êµì²´ ìš”ì•½ í‘œì‹œ
                const summary = document.getElementById('replacement-summary-2-2');
                summary.innerHTML = '<h4>ë³€ê²½ëœ í™”ìëª…:</h4>';
                
                for (const [name, count] of Object.entries(result.replacement_count)) {
                    summary.innerHTML += `<p>â€¢ "${name}" â†’ ${count}ë²ˆ ë³€ê²½ë¨</p>`;
                }

                // ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                document.getElementById('preview-2-2').textContent = result.content.substring(0, 500) + '...';
                document.getElementById('saved-path-2-2').textContent = result.saved_to;
                document.getElementById('result-2-2').style.display = 'block';

                updateStatus('2-2', 'completed');
                hideProgress();

                alert(`âœ… í™”ìëª… ë³€ê²½ ì™„ë£Œ!\nì €ì¥ ìœ„ì¹˜: ${result.saved_to}`);

            } catch (error) {
                showError(error.message);
                updateStatus('2-2', 'error');
            }
        });

        // ê·œì¹™ ì¶”ê°€ ë²„íŠ¼ - 2-1
        document.getElementById('btn-add-rule-2-1').addEventListener('click', function() {
            const rulesContainer = document.getElementById('replacement-rules-2-1');
            const newRow = document.createElement('div');
            newRow.className = 'replacement-row';
            newRow.innerHTML = `
                <input type="text" class="form-input-small" placeholder="ì°¾ì„ ë‹¨ì–´" data-type="old">
                <span class="arrow">â†’</span>
                <input type="text" class="form-input-small" placeholder="ë°”ê¿€ ë‹¨ì–´" data-type="new">
                <button type="button" class="btn-remove" onclick="removeRule(this)">Ã—</button>
            `;
            rulesContainer.appendChild(newRow);
        });

        // ê·œì¹™ ì¶”ê°€ ë²„íŠ¼ - 2-2
        document.getElementById('btn-add-rule-2-2').addEventListener('click', function() {
            const rulesContainer = document.getElementById('replacement-rules-2-2');
            const newRow = document.createElement('div');
            newRow.className = 'replacement-row';
            newRow.innerHTML = `
                <input type="text" class="form-input-small" placeholder="ì›ë˜ í™”ìëª…" data-type="old">
                <span class="arrow">â†’</span>
                <input type="text" class="form-input-small" placeholder="ìƒˆ í™”ìëª…" data-type="new">
                <button type="button" class="btn-remove" onclick="removeRule(this)">Ã—</button>
            `;
            rulesContainer.appendChild(newRow);
        });

        // ê·œì¹™ ì œê±°
        function removeRule(button) {
            const row = button.parentElement;
            const container = row.parentElement;
            
            // ìµœì†Œ 1ê°œëŠ” ìœ ì§€
            if (container.children.length > 1) {
                row.remove();
            }
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(step, status) {
            const statusElement = document.getElementById(`status-${step}`);
            
            if (status === 'processing') {
                statusElement.textContent = 'ì²˜ë¦¬ ì¤‘...';
                statusElement.className = 'section-status processing';
            } else if (status === 'completed') {
                statusElement.textContent = 'ì™„ë£Œ âœ“';
                statusElement.className = 'section-status completed';
            } else if (status === 'error') {
                statusElement.textContent = 'ì˜¤ë¥˜ âœ—';
                statusElement.className = 'section-status error';
            }
        }

        // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        function downloadFile(step) {
            const data = stepData[step];
            
            if (!data.content) {
                alert('ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const blob = new Blob([data.content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = data.filename;
            document.body.appendChild(a);
            a.click();
            URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        // ì§„í–‰ ìƒíƒœ í‘œì‹œ
        function showProgress(message) {
            document.getElementById('progressText').textContent = message;
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('errorSection').style.display = 'none';
        }

        // ì§„í–‰ ìƒíƒœ ìˆ¨ê¹€
        function hideProgress() {
            document.getElementById('progressSection').style.display = 'none';
        }

        // ì—ëŸ¬ í‘œì‹œ
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorSection').style.display = 'block';
            document.getElementById('progressSection').style.display = 'none';
            
            // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                document.getElementById('errorSection').style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
